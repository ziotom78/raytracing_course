<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Maurizio Tomasi &lt;maurizio.tomasi@unimi.it&gt;" />
  <title>A comparison between a few programming languages</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="./css/github-pandoc.css" />
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header id="title-block-header">
<h1 class="title">A comparison between a few programming languages</h1>
<p class="author">Maurizio Tomasi &lt;<a
href="mailto:maurizio.tomasi@unimi.it">maurizio.tomasi@unimi.it</a>&gt;</p>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="#change-history" id="toc-change-history">Change
history</a></li>
<li><a href="#introduction" id="toc-introduction">Introduction</a></li>
<li><a href="#how-to-learn-a-new-programming-language"
id="toc-how-to-learn-a-new-programming-language">How to learn a new
programming language</a></li>
<li><a href="#c" id="toc-c">C++</a></li>
<li><a href="#nim" id="toc-nim">Nim</a></li>
<li><a href="#crystal" id="toc-crystal">Crystal</a></li>
<li><a href="#c-1" id="toc-c-1">C#</a></li>
<li><a href="#d" id="toc-d">D</a></li>
<li><a href="#free-pascal" id="toc-free-pascal">Free Pascal</a></li>
<li><a href="#freebasic" id="toc-freebasic">FreeBasic</a></li>
<li><a href="#julia" id="toc-julia">Julia</a></li>
<li><a href="#kotlin" id="toc-kotlin">Kotlin</a></li>
<li><a href="#rust" id="toc-rust">Rust</a></li>
</ul>
</nav>
<h1 id="change-history">Change history</h1>
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 83%" />
</colgroup>
<thead>
<tr class="header">
<th>Date</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2023-12-16</td>
<td>Update a few links, correct typos</td>
</tr>
<tr class="even">
<td>2023-05-23</td>
<td>Add a few links, fix some typos</td>
</tr>
<tr class="odd">
<td>2023-01-02</td>
<td>Show a more interesting comparison between Ruby and Crystal</td>
</tr>
<tr class="even">
<td>2022-12-05</td>
<td>Add a few more information about Pascal</td>
</tr>
<tr class="odd">
<td>2022-09-30</td>
<td>Add a section about Crystal, fix some references</td>
</tr>
<tr class="even">
<td>2021-12-17</td>
<td>Add a description of how to «learn» a language</td>
</tr>
<tr class="odd">
<td>2021-12-08</td>
<td>Add a description of the D language, plus a few more fixes</td>
</tr>
<tr class="even">
<td>2021-01-02</td>
<td>Fix a few typos</td>
</tr>
<tr class="odd">
<td>2020-12-29</td>
<td>First release</td>
</tr>
</tbody>
</table>
<h1 id="introduction">Introduction</h1>
<p>The course <a
href="https://www.unimi.it/en/education/degree-programme-courses/2021/numerical-tecniques-photorealistic-image-generation">Numerical
tecniques for photorealistic image generation</a> (prof. Maurizio
Tomasi) aims to teach students how to develop complex computer codes to
model the phenomenon of light propagation. The student will learn how
large programs are structured, which are the best techniques to organize
the code, and how does one ensure quality and reproducibility of the
results.</p>
<p>As the course does not mandate the use of any official programming,
students might feel uneasy at picking one language out of the many
available: not only there are several well-known languages whose usage
is well-established in universities and industries (e.g., C, C++,
Fortran, Java, …), but a plethora of new languages are being created
every year: Rust, Julia, Nim, Crystal, etc.</p>
<p>In this document I show the peculiarities of a few languages that are
suitable for the course. I will start with C++, which is probably well
known by the majority of the students, and then I will move to other
languages. You are advised to read the section about C++ <em>even if you
do not plan to use this language</em>, as I will often refer to it when
describing other languages.</p>
<p>All the languages are presented following this schema:</p>
<ul>
<li><p>A short description of the language;</p></li>
<li><p>A code example, showing how to implement the following
features:</p>
<ul>
<li><p>A «vector» data structure that implements addition, scalar
product and scalar-vector product. This example is relevant for the
course, as we will make heavy use of 3D geometry.</p></li>
<li><p>A function to print a vector (or at least to convert it into a
string of characters) in human-readable form (e.g.,
<code>&lt;1.0, 3.0, 2.0&gt;</code>). This kind of function is handy to
have when debugging vector-related algorithms, and its implementation
shows how the language deals with strings.</p></li>
<li><p>A «ray» data structure that implements the geometric concept of a
<em>directed line</em>, i.e., a line starting from some point <span
class="math inline"><em>P</em></span> and running along some direction
<span class="math inline"><em>d⃗</em></span>.</p></li>
<li><p>A «sphere» data structure that describes a 3D sphere placed at
some position with a given radius.</p></li>
<li><p>An algorithm that tests whether a ray intersects a sphere, and at
which point in 3D space. Ray intersection tests will be widely used
during the course.</p></li>
</ul></li>
<li><p>Finally, for each language I will list its most notable
advantages and shortcomings.</p></li>
</ul>
<p>The purpose of this document is to provide students with a general
idea of some languages, but it is surely not meant to be exhaustive!
Other languages that are not covered here might still be well suited for
the course (e.g., <a href="https://chapel-lang.org/">Chapel</a>, <a
href="https://ocaml.org/">OCaml</a>): contact the teacher if you are
interested in any of those.</p>
<h1 id="how-to-learn-a-new-programming-language">How to learn a new
programming language</h1>
<p>The opinion of the teacher is that a student willing to learn a new
language should follow these steps:</p>
<ol type="1">
<li><p>Find and read a good book, or blog posts, or YouTube video that
show the basics of the language. Try to follow the exercises and type
them <em>on your own</em> instead of using cut-and-paste.</p></li>
<li><p>Watch a few YouTube videos that show how to actually <em>use</em>
the language beyond the syntax. This is a valuable way of learning how
to use editors and IDEs effectively, as these abilities are difficult to
grasp while reading a book. The difference with the videos mentioned in
Point 1 above is that here you should understand how the language works
<strong>in a development environment</strong>. For instance, <a
href="https://www.youtube.com/watch?v=4igzy3bGVkQ">A Gentle Introduction
to Julia</a> is a great way to learn Julia’s syntax, but videos like <a
href="https://www.youtube.com/watch?v=-lJK92bEKow">Getting Started with
Julia (for Experienced Programmers)</a> are more effective at this
stage, because the presenter shows how to set up Visual Studio Code and
use plugins to develop in Julia more efficiently. (Please do
<strong>not</strong> assume that Vim or Gedit are «all you need» for
this course: this is a mistake that students have done in the
past!)</p></li>
<li><p>Go to the <a href="https://projecteuler.net/">Project Euler
website</a> and use your newly-learned skills to implement solutions for
the first 5−10 problems. The problems in Project Euler are increasingly
complicated, but in a <em>mathematical</em> sense: you usually do not
need anything else other than <code>int</code>/<code>float</code>
variables and a few statements (<code>if</code>, <code>while</code>,
<code>for</code>) to solve them. (But as you progress through the
problems, they quickly become <em>mathematically hard</em> to solve, so
please do not go beyond the first 10–20 problems.)</p></li>
<li><p>Once you have successfully solved a few problems in Project
Euler, try to solve a few problems from the past editions of <a
href="https://adventofcode.com/">Advent of code</a>. These programs
require more skills than Project Euler’s, as they are focused on
<em>coding</em> rather than on <em>mathematics</em>. As Project Euler’s
problems, these are listed in increasing order of difficulty. It is not
needed that you do the exercises for this year, as the site keeps the
archives of the past editions (e.g., <a
href="https://adventofcode.com/2020">2020</a>, <a
href="https://adventofcode.com/2019">2019</a>, etc.).</p></li>
</ol>
<h1 id="c">C++</h1>
<p>There should be no need to present the C++ language. It is a widely
used language, and it is ok for the kind of tasks required in the
course. It was developed in the 1980s by Bjarne Stroustrup, which
adopted Object-Oriented Programming (OOP) atop the C language. In the
following years, C++ has progressively abandoned the OOP-centric
approach and has adopted other programming styles as well; today is
really a «multi-paradigm language».</p>
<p>To implement a «vector» data structure, one can use a
<code>struct</code>:</p>
<div class="sourceCode" id="cb1"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;sstream&gt;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;string&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Vec <span class="op">{</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> x<span class="op">,</span> y<span class="op">,</span> z<span class="op">;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">constexpr</span> Vec<span class="op">(</span><span class="dt">double</span> ax <span class="op">=</span> <span class="fl">0.0</span><span class="op">,</span> <span class="dt">double</span> ay <span class="op">=</span> <span class="fl">0.0</span><span class="op">,</span> <span class="dt">double</span> az <span class="op">=</span> <span class="fl">0.0</span><span class="op">)</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">:</span> x<span class="op">{</span>ax<span class="op">},</span> y<span class="op">{</span>ay<span class="op">},</span> z<span class="op">{</span>az<span class="op">}</span> <span class="op">{}</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">std::</span>string format<span class="op">()</span> <span class="at">const</span> <span class="op">{</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        <span class="bu">std::</span>stringstream sstr<span class="op">;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        sstr <span class="op">&lt;&lt;</span> <span class="st">&quot;&lt;&quot;</span> <span class="op">&lt;&lt;</span> x <span class="op">&lt;&lt;</span> <span class="st">&quot;, &quot;</span> <span class="op">&lt;&lt;</span> y <span class="op">&lt;&lt;</span> <span class="st">&quot;, &quot;</span> <span class="op">&lt;&lt;</span> z <span class="op">&lt;&lt;</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> sstr<span class="op">.</span>str<span class="op">();</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="op">[[</span><span class="at">nodiscard</span><span class="op">]]</span> <span class="kw">constexpr</span> Vec <span class="kw">operator</span><span class="op">*(</span><span class="dt">double</span> t<span class="op">,</span> <span class="at">const</span> Vec <span class="op">&amp;</span> v<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Vec<span class="op">{</span>t <span class="op">*</span> v<span class="op">.</span>x<span class="op">,</span> t <span class="op">*</span> v<span class="op">.</span>y<span class="op">,</span> t <span class="op">*</span> v<span class="op">.</span>z<span class="op">};</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="op">[[</span><span class="at">nodiscard</span><span class="op">]]</span> <span class="kw">constexpr</span> <span class="dt">double</span> <span class="kw">operator</span><span class="op">*(</span><span class="at">const</span> Vec <span class="op">&amp;</span>v<span class="op">,</span> <span class="at">const</span> Vec <span class="op">&amp;</span> w<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> v<span class="op">.</span>x <span class="op">*</span> w<span class="op">.</span>x <span class="op">+</span> v<span class="op">.</span>y <span class="op">*</span> w<span class="op">.</span>y <span class="op">+</span> v<span class="op">.</span>z <span class="op">*</span> w<span class="op">.</span>z<span class="op">;</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>As stated in the introduction, the purpose of the code examples shown
in this document is to illustrate how to implement custom operators for
the <code>Vec</code> class, namely sum, dot product, and scalar-vector
product. Printing a <code>Vec</code> object is implemented through the
<code>Vec::format</code> method, which uses a
<code>std::stringstream</code> object; this is the standard approach in
C++17, although students developing their programs for the course can
rely on more advanced libraries<a href="#fn1" class="footnote-ref"
id="fnref1" role="doc-noteref"><sup>1</sup></a> to format strings.</p>
<p>The code above makes use of a few features of C++17, like the
<code>[[nodiscard]]</code> and <code>constexpr</code> specifiers.
Students willing to use C++ in this course should become accustomed with
the most recent releases of the C++ standard.</p>
<p>The following code implements the <code>Ray</code> and
<code>Sphere</code> data structures; the latter has the method
<code>intersect</code>, which checks if a ray (oriented line) and a
sphere intersect. It is not fundamental to understand the mathematics
used here; it is enough to note that the code makes use of overloaded
operators on the <code>Vec</code> class, like the ones I defined above
(sum, dot product, scalar-vector product).</p>
<div class="sourceCode" id="cb2"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Ray <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  Vec <span class="va">m_o</span><span class="op">,</span> <span class="va">m_d</span><span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> <span class="va">m_tmin</span><span class="op">,</span> <span class="va">m_tmax</span><span class="op">;</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  Ray<span class="op">(</span><span class="at">const</span> Vec <span class="op">&amp;</span>origin<span class="op">,</span> <span class="at">const</span> Vec <span class="op">&amp;</span>dir<span class="op">)</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="va">m_o</span><span class="op">{</span>origin<span class="op">},</span> <span class="va">m_d</span><span class="op">{</span>dir<span class="op">},</span> <span class="va">m_tmin</span><span class="op">{</span>DEFAULT_TMIN<span class="op">},</span> <span class="va">m_tmax</span><span class="op">{</span>DEFAULT_TMAX<span class="op">}</span> <span class="op">{}</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Sphere <span class="op">{</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> <span class="va">m_r</span><span class="op">;</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  Vec <span class="va">m_p</span><span class="op">;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">constexpr</span> Sphere<span class="op">(</span><span class="dt">double</span> r<span class="op">,</span> Vec p<span class="op">)</span> <span class="op">:</span> <span class="va">m_r</span><span class="op">{</span>r<span class="op">},</span> <span class="va">m_p</span><span class="op">{</span>p<span class="op">}</span> <span class="op">{}</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="op">[[</span><span class="at">nodiscard</span><span class="op">]]</span> <span class="kw">constexpr</span> <span class="dt">bool</span> intersect<span class="op">(</span>Ray <span class="op">&amp;</span>ray<span class="op">)</span> <span class="at">const</span> <span class="kw">noexcept</span> <span class="op">{</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> Vec op<span class="op">{</span><span class="va">m_p</span> <span class="op">-</span> ray<span class="op">.</span><span class="va">m_o</span><span class="op">};</span>     <span class="co">// Vector difference</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">double</span> dop<span class="op">{</span>ray<span class="op">.</span><span class="va">m_d</span> <span class="op">*</span> op<span class="op">};</span>  <span class="co">// Dot product</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">double</span> D<span class="op">{</span>dop <span class="op">*</span> dop <span class="op">-</span> op <span class="op">*</span> op <span class="op">+</span> <span class="va">m_r</span> <span class="op">*</span> <span class="va">m_r</span><span class="op">};</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span><span class="fl">0.0</span> <span class="op">&gt;</span> D<span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">double</span> sqrtD<span class="op">{</span>sqrt<span class="op">(</span>D<span class="op">)};</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">double</span> tmin<span class="op">{</span>dop <span class="op">-</span> sqrtD<span class="op">};</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ray<span class="op">.</span><span class="va">m_tmin</span> <span class="op">&lt;</span> tmin <span class="op">&amp;&amp;</span> tmin <span class="op">&lt;</span> ray<span class="op">.</span><span class="va">m_tmax</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">const</span> <span class="dt">double</span> tmax<span class="op">{</span>dop <span class="op">+</span> sqrtD<span class="op">};</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ray<span class="op">.</span><span class="va">m_tmin</span> <span class="op">&lt;</span> tmax <span class="op">&amp;&amp;</span> tmax <span class="op">&lt;</span> ray<span class="op">.</span><span class="va">m_tmax</span><span class="op">;</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>Apart from the mathematical details, everything in the code above
should look familiar to anybody who has written C++ programs in the
past.</p>
<p>Let’s now list a few advantages of C++:</p>
<ul>
<li>Almost every student should have already learnt the language in
their freshman’s years;</li>
<li>The commonly used C++ compilers (GCC, Clang) produce very fast
executables;</li>
<li>There are some very good IDEs that ease code writing; a particularly
good one is CLion (<a
href="https://www.jetbrains.com/clion/">www.jetbrains.com/clion</a>);
other good choices are Qt Creator (<a
href="https://www.qt.io/product/development-tools">www.qt.io/product/development-tools</a>)
and Visual Studio Code (<a
href="https://code.visualstudio.com/">code.visualstudio.com</a>);</li>
<li>There are plenty of resources around to use when one is stuck. You
are advised to bookmark the site <a
href="https://www.cplusplus.com/">www.cplusplus.com</a>, which contains
the documentation of the whole C++ standard library as well as several
examples.</li>
</ul>
<p>However, the language has its warts:</p>
<ul>
<li><p>No standard way to download and install external libraries, as
many students who have tried to install ROOT on their own computers
already know. (Unlike other languages like Rust, C#, Julia, Nim, there
is no standard package manager for C++.) In the past, this has proven to
be the biggest pain points for students who picked C++.</p></li>
<li><p>No standard unit testing library. As we will rely heavily on unit
tests, this point is particularly relevant for the course.</p></li>
<li><p>No standard way to compile and deploy applications.</p></li>
<li><p>It can be extremely complex. Consider these examples:</p>
<ul>
<li><p>The way one has to declare classes in header files and implement
functions in <code>.cpp</code> files is error-prone, because of the way
dependencies must be specified<a href="#fn2" class="footnote-ref"
id="fnref2" role="doc-noteref"><sup>2</sup></a> in
<code>Makefile</code>. Students picking C++ are expected to use advanced
build systems like CMake (<a
href="https://cmake.org/">cmake.org</a>).</p></li>
<li><p>The new uniform initialization using <code>{}</code> introduced
by C++11, despite being a significant advantage over the old way to
initialize stuff, can be confusing. Consider this example:</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> v1<span class="op">(</span><span class="dv">4</span><span class="op">,</span> <span class="dv">3</span><span class="op">);</span>  <span class="co">// Result: 3, 3, 3, 3</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">int</span><span class="op">&gt;</span> v2<span class="op">{</span><span class="dv">4</span><span class="op">,</span> <span class="dv">3</span><span class="op">};</span>  <span class="co">// Result: 4, 3</span></span></code></pre></div></li>
<li><p>The rule to use <code>;</code> is inconsistent, as it is
mandatory to use a <code>;</code> after a class but not after having
defined a function/method:</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>   <span class="co">// No `;` is required here…</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Vec <span class="op">{</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> x<span class="op">,</span> y<span class="op">,</span> z<span class="op">;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span>  <span class="co">// …but here it is!</span></span></code></pre></div></li>
<li><p>The syntax to invoke a constructor with no parameters for a class
look weird, as you must avoid appending <code>()</code>, unlike you do
when calling a function with no parameters:</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> rand<span class="op">();</span>  <span class="co">// Ok, call rand without arguments</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Error: this does *not* mean that the default constructor</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">// (without arguments) must be called</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>MyClass obj<span class="op">();</span></span></code></pre></div></li>
<li><p>The standard library makes a heavy use of templates, which often
make error messages complex.</p></li>
<li><p>It inherits the way C deals with pointers, which enables to write
really weird code:</p>
<div class="sourceCode" id="cb6"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;iostream&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> a<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">3</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">5</span><span class="op">};</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Surprise! This compiles and prints &quot;5&quot;. Guess why?</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> <span class="dv">2</span><span class="op">[</span>a<span class="op">]</span> <span class="op">&lt;&lt;</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li>
</ul></li>
</ul>
<p>Past experience has shown that people that picked C++ because they
felt the course would have been «easier» to follow have had to tackle
several problems that were non-existent in other languages. If you want
to pick an easy language to use, you should avoid C++ and choose
something else; good choices are C#, Nim, or Crystal.</p>
<p>On the other hand, people that already had a strong interest in C++
were satisfied to have used it, as they felt they significantly improved
their coding skills.</p>
<h1 id="nim">Nim</h1>
<p>Nim (<a href="https://nim-lang.org/">nim-lang.org</a>) is not as
widespread and used as C#, Kotlin, etc. However, it is extremely well
designed and performant. It was created by Andreas Rumpf in 2008, and it
is deeply inspired by the Pascal language. (In fact, the very first Nim
compiler was written in <a
href="https://www.freepascal.org/">FreePascal</a>.)</p>
<p>Nim is the language I used to prepare both the HTML version of the
course slides and the course notes. I picked it because it can either
produce a standalone executable or a Javascript code to be loaded in
HTML pages. This means that Nim programs can be run either from the
terminal or within a web browser; this is a feature that only a few
languages offer. (See below for an example.)</p>
<p>Nim’s syntax looks like a mixture of Python and Pascal, as the
following implementation of the <code>Vec</code> data type shows:</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode nim"><code class="sourceCode nim"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">Vec</span> <span class="co">=</span> <span class="kw">object</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>        x<span class="co">*</span><span class="kw">,</span> y<span class="co">*</span><span class="kw">,</span> z<span class="co">*</span> <span class="kw">:</span> <span class="at">float64</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># The $ procedure translates any value to a string</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="st">`$`</span><span class="co">*</span><span class="kw">(</span><span class="fu">v</span> <span class="kw">:</span> <span class="at">Vec</span><span class="kw">)</span> <span class="kw">:</span> <span class="at">string</span> <span class="co">=</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>    <span class="ot">result</span> <span class="co">=</span> <span class="st">&quot;&lt;&quot;</span> <span class="co">&amp;</span> <span class="co">$</span><span class="kw">(</span>v<span class="kw">.</span><span class="at">x</span><span class="kw">)</span> <span class="co">&amp;</span> <span class="st">&quot;, &quot;</span> <span class="co">&amp;</span> <span class="co">$</span><span class="kw">(</span>v<span class="kw">.</span><span class="at">y</span><span class="kw">)</span> <span class="co">&amp;</span> <span class="st">&quot;, &quot;</span> <span class="co">&amp;</span> <span class="co">$</span><span class="kw">(</span>v<span class="kw">.</span><span class="at">z</span><span class="kw">)</span> <span class="co">&amp;</span> <span class="st">&quot;&gt;&quot;</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="st">`*`</span><span class="co">*</span><span class="kw">(</span>a<span class="kw">,</span> <span class="fu">b</span> <span class="kw">:</span> <span class="at">Vec</span><span class="kw">)</span> <span class="kw">:</span> <span class="at">float64</span> <span class="co">=</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="ot">result</span> <span class="co">=</span> a<span class="kw">.</span><span class="at">x</span> <span class="co">*</span> b<span class="kw">.</span><span class="at">x</span> <span class="co">+</span> a<span class="kw">.</span><span class="at">y</span> <span class="co">*</span> b<span class="kw">.</span><span class="at">y</span> <span class="co">+</span> a<span class="kw">.</span><span class="at">z</span> <span class="co">*</span> b<span class="kw">.</span><span class="at">z</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="st">`*`</span><span class="co">*</span><span class="kw">(</span><span class="fu">t</span> <span class="kw">:</span> <span class="at">float64</span><span class="kw">;</span> <span class="fu">v</span> <span class="kw">:</span> <span class="at">Vec</span><span class="kw">)</span> <span class="kw">:</span> <span class="at">Vec</span> <span class="co">=</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="ot">result</span><span class="kw">.</span><span class="at">x</span> <span class="co">=</span> t <span class="co">*</span> v<span class="kw">.</span><span class="at">x</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    <span class="ot">result</span><span class="kw">.</span><span class="at">y</span> <span class="co">=</span> t <span class="co">*</span> v<span class="kw">.</span><span class="at">y</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>    <span class="ot">result</span><span class="kw">.</span><span class="at">z</span> <span class="co">=</span> t <span class="co">*</span> v<span class="kw">.</span><span class="at">z</span></span></code></pre></div>
<p>In Nim, a <code>object</code> is like a <code>struct</code> in C++.
The use of <code>*</code> at the end of functions, variables, and
methods indicates that these should be made <em>public</em>, i.e., they
should be exported whenever the file is imported by some script. It is
quite like the <code>public</code> keyword in C++.</p>
<p>Nim uses the <code>type</code> keyword, much like Pascal. However, it
avoids using <code>{}</code> or <code>begin..end</code> like in C++ or
Pascal, because like Python it uses indentation to delimit the extents
of functions.</p>
<p>Note that you can redefine operators like <code>+</code> and
<code>*</code> using the <code>func</code> keyword, instead of using
dedicated keywords like <code>operator</code> in C++: only, you must
wrap them within backticks (<code>`</code>), like in
<code>func `$`*</code>.</p>
<p>Returning values from procedures requires to use the implicit
<code>result</code> variable. (This feature is shared with Pascal.)</p>
<p>The following code shows how to implement the <code>Ray</code> and
<code>Sphere</code> data structures, as well as the ray/sphere
intersection:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode nim"><code class="sourceCode nim"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> math</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Ray</span> <span class="co">=</span> <span class="kw">object</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        m_o<span class="co">*</span> <span class="kw">:</span> <span class="at">Vec</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        m_d<span class="co">*</span> <span class="kw">:</span> <span class="at">Vec</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        m_tmin<span class="co">*</span> <span class="kw">:</span> <span class="at">float64</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        m_tmax<span class="co">*</span> <span class="kw">:</span> <span class="at">float64</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sphere</span> <span class="co">=</span> <span class="kw">object</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        m_p<span class="co">*</span> <span class="kw">:</span> <span class="at">Vec</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        m_r<span class="co">*</span> <span class="kw">:</span> <span class="at">float64</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="kw">func</span> <span class="st">intersect</span><span class="kw">(</span>sphere<span class="kw">:</span> <span class="at">Sphere</span><span class="kw">;</span> ray<span class="kw">:</span> <span class="at">Ray</span><span class="kw">)</span> <span class="kw">:</span> <span class="at">bool</span> <span class="co">=</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> op <span class="co">=</span> sphere<span class="kw">.</span><span class="at">m_p</span> <span class="co">-</span> ray<span class="kw">.</span><span class="at">m_o</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> dop <span class="co">=</span> ray<span class="kw">.</span><span class="at">m_d</span> <span class="co">*</span> op</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> <span class="at">D</span> <span class="co">=</span> dop <span class="co">*</span> dop <span class="co">-</span> op <span class="co">*</span> op <span class="co">+</span> sphere<span class="kw">.</span><span class="at">m_r</span> <span class="co">*</span> sphere<span class="kw">.</span><span class="at">m_r</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="dv">0</span> <span class="co">&gt;</span> <span class="at">D</span><span class="kw">:</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="cn">false</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> sqrtD <span class="co">=</span> <span class="fu">sqrt</span><span class="kw">(</span><span class="at">D</span><span class="kw">)</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> tmin <span class="co">=</span> dop <span class="co">-</span> sqrtD</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">(</span>ray<span class="kw">.</span><span class="at">m_tmin</span> <span class="co">&lt;</span> tmin<span class="kw">)</span> <span class="co">and</span> <span class="kw">(</span>tmin <span class="co">&lt;</span> ray<span class="kw">.</span><span class="at">m_tmax</span><span class="kw">):</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="cn">true</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> tmax <span class="co">=</span> dop <span class="co">-</span> sqrtD</span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">(</span>ray<span class="kw">.</span><span class="at">m_tmin</span> <span class="co">&lt;</span> tmax<span class="kw">)</span> <span class="co">and</span> <span class="kw">(</span>tmax <span class="co">&lt;</span> ray<span class="kw">.</span><span class="at">m_tmax</span><span class="kw">)</span></span></code></pre></div>
<p>Nim introduces <em>three</em> ways to declare variables:</p>
<ul>
<li><p>Using <code>const</code>, the value of a variable (well, it is
indeed a «constant» rather than a «variable») must be known at
compilation time;</p></li>
<li><p>Using <code>let</code>, the value of a variable is assigned once
and never changed later;</p></li>
<li><p>Using <code>var</code>, a variable can be changed as many times
as needed, but without changing its type.</p></li>
</ul>
<p>The difference between <code>const</code> and <code>let</code> is
subtle; typically the programmer does not know what the value used in a
<code>let</code> will be, but once it is assigned it is not going to be
changed. A typical case for <code>let</code> is for some input from the
user (e.g., a file name containing some input data): the programmer
cannot tell what is going to be the name of the file, but surely the
variable <code>file_name</code> is not going to be changed once it is
assigned. On the other hand, mathematical constants like <span
class="math inline"><em>π</em></span> are known in advance and should be
declared as <code>const</code>. This distinction improves a lot the
clarity of the code, as most of the situations where one declares a
variable, they usually mean to use a <code>let</code>, i.e., the
variable is assigned but then never changed.</p>
<p>Nim has several advantages over other languages:</p>
<ul>
<li><p>No need to write a <code>Makefile</code>, just type</p>
<pre><code>nim compile --run FILENAME.nim</code></pre>
<p>to compile and run <code>FILENAME.nim</code>; this triggers the
compilation of any file used by <code>FILENAME.nim</code>. (The command
<code>nim compile --run</code> can be shortened to
<code>nim c -r</code>.)</p></li>
<li><p>It has a clean syntax, with no <code>;</code>
characters;</p></li>
<li><p>The code runs very fast: in fact, together with FreeBASIC and
Crystal, it is the only language able to consistently reach C++ speeds
in the codes I have written for this course.</p></li>
<li><p>Internally, Nim produces a C program that is then compiled by
<code>gcc</code> or <code>clang</code>. (A switch forces the Nim
compiler to generate a C++ program, which can be fed to <code>g++</code>
or <code>clang++</code>.) Thanks to this way of compiling executables,
it is trivial to use C/C++ libraries<a href="#fn3" class="footnote-ref"
id="fnref3" role="doc-noteref"><sup>3</sup></a> within a Nim program,
using the two pragmas <code>{.importc.}</code> and
<code>{.importcpp.}</code>.</p></li>
<li><p>Similarly to C#, Rust, Crystal, and Julia, it has a standard
package manager, <code>nimble</code>, which provides the ability to
quickly create and run empty «Hello world!» projects, as well as
downloading and installing libraries from the web.</p>
<p>The following command creates a new Nim program in the directory
<code>myproj</code>:</p>
<pre><code>$ nimble init newproj</code></pre>
<p>Within the folder <code>myproj</code>, the following command compiles
and run the program:</p>
<pre><code>$ nimble run</code></pre></li>
<li><p>Being able to convert Nim code to C/C++ code, the Nim compiler
can produce standalone executables by calling automatically a C/C++
compiler. But it is able to produce a Javascript program, which can be
loaded within a HTML page and run in a browser (<a
href="https://nim-lang.org/docs/backends.html#backends-the-javascript-target">nim-lang.org/docs/backends.html</a>).</p>
<p>The following image shows the result of applying a 3D projection code
to produce a HTML page (left) and a PDF image (right):</p>
<p><img src="pd-images/nim-html-canvas.png" /></p>
<p>The two images look the same because they have been rendered using
the same code, yet the two formats enable different applications:</p>
<ol type="1">
<li>The image on the left is included in a live HTML page, and the
controls at the bottom enable the user to customize the angle of view:
changing the numbers triggers a call to the Javascript code produced by
the Nim compiler out of my Nim source code.</li>
<li>The image on the right is produced by the same Nim code that has
been compiled to C and then fed to <code>gcc</code>. The output program
invokes Cairo<a href="#fn4" class="footnote-ref" id="fnref4"
role="doc-noteref"><sup>4</sup></a>, a C library that generates PDF
files (<a
href="https://www.cairographics.org/">www.cairographics.org</a>), and it
is thus suitable to be included in a LaTeX file.</li>
</ol></li>
</ul>
<p>Disadvantages:</p>
<ul>
<li><p>Unfortunately Nim does not have a wide user base. As a
consequence, there are not many online resources to learn the
language.</p></li>
<li><p>The quality of the documentation is not as high as for other
languages (e.g., C#). This is partly mitigated by the existence of three
books about Nim: <a
href="https://www.manning.com/books/nim-in-action"><em>Nim in
action</em></a>, by Dominik Picheta (Manning, 2017), <a
href="http://ssalewski.de/nimprogramming.html"><em>Computer programming
with the Nim programming language</em></a>, by Stefan Salewski, which is
an e-book available for free, and <a
href="https://www.amazon.com/Mastering-Nim-complete-programming-language/dp/B0B4R7B9YX"><em>Mastering
Nim</em></a>, by Nim’s creator, Andreas Rumpf. (However, I have never
read the latter, so I cannot comment about its quality.)</p></li>
</ul>
<p>The opinion of the teacher is that Nim is one of the best language to
use for this course: it is easy to learn, extremely performant, and it
provides all the tools needed to implement the tasks required in the
curse. Moreover, it is extremely elegant and well-designed.</p>
<h1 id="crystal">Crystal</h1>
<p>The Crystal language is one of the youngest languages considered in
this document. The history that leads to Crystal is interesting and
worth to be told. Crystal is a reboot of the famous <a
href="https://www.ruby-lang.org/en/">Ruby language</a>, which in turns
is a take over the old <a href="https://en.wikipedia.org/wiki/Perl">Perl
language</a>. Perl is a language created by <a
href="https://en.wikipedia.org/wiki/Larry_Wall">Larry Wall</a>, whose
name was originally «Pearl» (a reference to the <a
href="https://en.wikipedia.org/wiki/Parable_of_the_Pearl"><em>pearl of
great price</em></a> in Matthew’s Gospel) and indicated the aim to
produce a useful tool to administer servers. Perl was used to create the
<a href="https://www.gnu.org/software/autoconf/">autoconf</a> tool,
which is well known to any Linux programmer; moreover, it backs up
websites like <a href="https://www.booking.com/">Booking.com</a>.
However, despite being very famous, Perl is also known for its lack of
readability; consider this example, taken from a <a
href="https://www.tutorialspoint.com/perl/perl_special_variables.htm#">Perl
tutorial</a>:</p>
<div class="sourceCode" id="cb12"><pre
class="sourceCode perl"><code class="sourceCode perl"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save this in a file &quot;test.pl&quot; and run it using</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    perl test.pl</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="kw">foreach</span> (<span class="ot">&#39;</span><span class="ss">hickory</span><span class="ot">&#39;</span>,<span class="ot">&#39;</span><span class="ss">dickory</span><span class="ot">&#39;</span>,<span class="ot">&#39;</span><span class="ss">doc</span><span class="ot">&#39;</span>) {</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>;</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span> <span class="ot">&quot;</span><span class="ch">\n</span><span class="ot">&quot;</span>;</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>The program is very simple to read and more lightweight than it would
have been in C++ (with its <code>#include &lt;iostream&gt;</code>, and
<code>using namespace std</code>, and stuff like that). However, the
output of the program is a surprise:</p>
<pre><code>hickory
dickory
doc</code></pre>
<p>This happens because within the <code>foreach</code> loop the hidden
variable <code>$_</code> is set to the value of the three elements in
the list, and the <code>print</code> command outputs the value of
<code>$_</code> if nothing else is passed. Perl is full of hidden
parameters and shortcuts that can make source code very hard to
understand.</p>
<p>For this reason, in the mid-1990s a Japanese programmer, Yukihiro
Matsumoto, created <a
href="https://en.wikipedia.org/wiki/Ruby_(programming_language)">Ruby</a>,
whose name is of course a reference to «pearl», Perl’s original name.
Ruby’s aim is to be as versatile as Perl but far easier to read. It
achieved huge success in early 2000s and was fundamental for the spread
of modern websites, thanks to its famous web framework <a
href="https://rubyonrails.org/">Ruby on rails</a>, which powers sites
like <a href="https://github.com/">GitHub</a> (we’ll use it a lot in
this course!) and <a href="https://www.airbnb.com/">Airbnb</a>. Ruby
programs read like English and are easy to understand even by people
that are not proficient with the language. Here is the Perl program
shown above translated to Ruby; as you can see, there are no hidden
variables, yet the program is very simple and free of noise:</p>
<div class="sourceCode" id="cb14"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save this in a file &quot;test.rb&quot; and run it using</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    ruby test.rb</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="kw">[</span><span class="vs">&#39;hickory&#39;</span>,<span class="vs">&#39;dickory&#39;</span>,<span class="vs">&#39;doc&#39;</span><span class="kw">]</span><span class="at">.each</span> <span class="cf">do</span> <span class="kw">|</span>x<span class="kw">|</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">puts</span> x</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p>The problem with Ruby is its slowness, as it is an interpreted
language much like Perl and Python: programs written in Ruby can be
orders of magnitude slower than C++ programs!</p>
<p>In 2014, a team of developers released the <a
href="https://crystal-lang.org/">Crystal language</a>: again, a pun to
«pearls» and «rubies»! The syntax of Crystal programs is very similar to
Ruby’s, but its creators added ahead-of-time compilation through the
LLVM framework: this means that programs must be compiled into an
executable before being executed. (It’s the same in C and C++, where you
must call <code>gcc</code> or <code>g++</code> to build an executable,
but unlike Perl, Python, or Ruby.) The usage of LLVM enables Crystal
programs to be as fast as programs written in C++, Julia, or Rust.</p>
<p>Let’s show how to define a new type, <code>Vec</code>, using
Crystal:</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A &quot;struct&quot; is like a &quot;class&quot;, but it has fewer features and enables</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the compiler to produce more efficient code</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>struct <span class="dt">Vec</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># These would be called member variables; their type is</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># deduced by the constructor `initialize` (see below)</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  property x, y, z</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># `Initialize` is the name of the constructor; in C++ you would</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># have written `Vec::Vec`. Note that using `@` in front of the</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># parameters mean that they must be used to initialize the</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># properties with the same name. Here we declare that `x`, `y`,</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and `z` are 64-bit floating point values.</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">def</span> initialize(<span class="ot">@x</span> : <span class="dt">Float64</span>, <span class="ot">@y</span> : <span class="dt">Float64</span>, <span class="ot">@z</span> : <span class="dt">Float64</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Operator overloading is very simple to do in Crystal!</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                   +------+     This means that the result is of</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">#                   |      |  &lt;- the same type as the class, `Vec`</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">def</span> <span class="kw">+</span>(other : <span class="dv">self</span>) : <span class="dv">self</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Like in Julia, if it&#39;s the last line before a `end`,</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># you can avoid writing `return` explicitly</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Vec</span><span class="at">.new</span>(<span class="ot">@x</span> <span class="kw">+</span> other<span class="at">.x</span>, <span class="ot">@y</span> <span class="kw">+</span> other<span class="at">.y</span>, <span class="ot">@z</span> <span class="kw">+</span> other<span class="at">.z</span>)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">def</span> <span class="kw">-</span>(other : <span class="dv">self</span>) : <span class="dv">self</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>    <span class="dt">Vec</span><span class="at">.new</span>(<span class="ot">@x</span> <span class="kw">-</span> other<span class="at">.x</span>, <span class="ot">@y</span> <span class="kw">-</span> other<span class="at">.y</span>, <span class="ot">@z</span> <span class="kw">-</span> other<span class="at">.z</span>)</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Specifying the return type is not mandatory, the compiler is smart</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># enough to figure it out. If you want to be explicit, you can write</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     def *(other : self) : Float64</span></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">#</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">def</span> <span class="kw">*</span>(other : <span class="dv">self</span>)</span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>    <span class="ot">@x</span> <span class="kw">*</span> other<span class="at">.x</span> <span class="kw">+</span> <span class="ot">@y</span> <span class="kw">*</span> other<span class="at">.y</span> <span class="kw">+</span> <span class="ot">@z</span> <span class="kw">*</span> other<span class="at">.z</span></span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># `to_s` means: «convert this type into a string»</span></span>
<span id="cb15-40"><a href="#cb15-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">def</span> to_s : <span class="dt">String</span></span>
<span id="cb15-41"><a href="#cb15-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;&lt;</span><span class="sc">#@x</span><span class="st">, </span><span class="sc">#@y</span><span class="st">, </span><span class="sc">#@z</span><span class="st">&gt;&quot;</span>  <span class="co"># In strings, writing @variable means:</span></span>
<span id="cb15-42"><a href="#cb15-42" aria-hidden="true" tabindex="-1"></a>                       <span class="co"># «put here the value of the variable»</span></span>
<span id="cb15-43"><a href="#cb15-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb15-44"><a href="#cb15-44" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p>The weird variable names with <code>@</code> refer to <em>member
variables</em>; in Python, you would write <code>self.x</code> instead
of <code>@x</code>. As you can see, operator overloading is extremely
easy in Crystal. The method <code>initialize</code> is the constructor;
in C++ it would have been named <code>Vec::Vec</code>.</p>
<p>Defining <code>Ray</code> and <code>Sphere</code> is equally
simple:</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>struct <span class="dt">Ray</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  property m_o, m_d, m_tmin, m_tmax</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">def</span> initialize(<span class="ot">@m_o</span> : <span class="dt">Vec</span>, <span class="ot">@m_d</span> : <span class="dt">Vec</span>, <span class="ot">@m_tmin</span> <span class="kw">=</span> <span class="dv">1</span>e<span class="dv">-10</span>, <span class="ot">@m_tmax</span> <span class="kw">=</span> <span class="dv">1</span>e<span class="kw">+</span><span class="dv">10</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="cf">class</span> <span class="dt">Sphere</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  property m_r, m_p</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">def</span> initialize(<span class="ot">@m_r</span> : <span class="dt">Float64</span>, <span class="ot">@m_p</span> : <span class="dt">Vec</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">def</span> intersect(ray : <span class="dt">Ray</span>) : <span class="dt">Bool</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    op <span class="kw">=</span> <span class="ot">@m_p</span> <span class="kw">-</span> ray<span class="at">.m_o</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    dop <span class="kw">=</span> ray<span class="at">.m_d</span> <span class="kw">*</span> op</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    d <span class="kw">=</span> dop <span class="kw">**</span> <span class="dv">2</span> <span class="kw">-</span> op <span class="kw">*</span> op <span class="kw">+</span> <span class="ot">@m_r</span> <span class="kw">**</span> <span class="dv">2</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This kind of &quot;if&quot; syntax makes the code very readable like English!</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># But you can write plain &quot;if&quot; statements like Python and C++, if you want.</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">false</span> <span class="cf">if</span> <span class="dv">0</span> <span class="kw">&gt;</span> d</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>    sqrtd <span class="kw">=</span> <span class="dt">Math</span><span class="at">.sqrt</span>(d)</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>    tmin <span class="kw">=</span> dop <span class="kw">-</span> sqrtd</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">true</span> <span class="cf">if</span> (ray<span class="at">.m_tmin</span> <span class="kw">&lt;</span> tmin) <span class="kw">&amp;&amp;</span> (tmin <span class="kw">&lt;</span> ray<span class="at">.m_tmax</span>)</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>    tmax <span class="kw">=</span> dop <span class="kw">+</span> sqrtd</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    ((ray<span class="at">.m_tmin</span> <span class="kw">&lt;</span> tmax) <span class="kw">&amp;&amp;</span> (tmax <span class="kw">&lt;</span> ray<span class="at">.m_tmax</span>))</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">end</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p>The performance of the code is extremely good and perfectly
comparable with C++ or Rust.</p>
<p>Here are a few highlights from the language:</p>
<ul>
<li><p>The <code>crystal</code> compiler supports a web-based
interactive editor that is very handy when you are learning the
language. Just start <code>crystal play</code> and open your web browser
to the local address <a
href="http://127.0.0.1:8080/">http://127.0.0.1:8080/</a>.</p></li>
<li><p>The most notable feature of Crystal is its heavy inspiration on
the Ruby syntax: simple scripts can be either interpreted as written in
Ruby and Crystal. This means that when you look for information about
how to do something in Crystal, there are chances that you might reuse
some StackOverflow answer about Ruby, which is far more widely used than
Crystal. (Of course, Crystal is <strong>not</strong> Ruby, and anything
but the simplest Ruby scripts won’t compile as Crystal programs.)</p>
<p>As an example, consider the following program, which calculates the
sum of the first 100 000 000 numbers:</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save this in file &quot;test.rb&quot;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>maxnum <span class="kw">=</span> <span class="dv">100_000_000</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>sum <span class="kw">=</span> <span class="fl">0.0</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span><span class="kw">..</span>maxnum)<span class="at">.each</span> <span class="cf">do</span> <span class="kw">|</span>num<span class="kw">|</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    sum <span class="kw">+=</span> num</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="fu">puts</span> <span class="st">&quot;The sum of the first </span><span class="sc">#{</span>maxnum<span class="sc">}</span><span class="st"> numbers is </span><span class="sc">#{</span>sum<span class="sc">}</span><span class="st">&quot;</span></span></code></pre></div>
<p>This is valid code in Ruby, but also in Crystal, and you can run it
using either the <code>ruby</code> interpreted or the
<code>crystal</code> compiler:</p>
<pre><code>$ ruby test.rb
The sum of the first 100000000 numbers is 5.00000005e+15

$ crystal run test.rb
The sum of the first 100000000 numbers is 5.00000005e+15</code></pre>
<p>However, the big difference between the two ways of running the code
is that the former is <em>interpreted</em> by Ruby, while the second is
<em>compiled</em> to optimized machine code. In fact, if we compile the
program using <code>crystal build --release</code> and time the
execution, we can see the huge difference in the time required to
produce the output:</p>
<pre><code>$ time ruby test.rb
The sum of the first 100000000 numbers is 5.00000005e+15

real    0m7,504s
user    0m7,436s
sys     0m0,034s

$ crystal build --release -o ./test test.rb

$ time ./test
The sum of the first 100000000 numbers is 5.00000005e+15

real    0m0,105s
user    0m0,103s
sys     0m0,000s</code></pre>
<p>The program compiled by Crystal took just 0.1 s, while the one
interpreted by Ruby was 75 times slower!</p></li>
<li><p>Crystal is an OOP language, much more object-oriented than C++.
In C++, you can call class methods using the dot <code>.</code>:</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="bu">std::</span>string s <span class="op">=</span> <span class="st">&quot;Hello&quot;</span><span class="op">;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Call the method &quot;size&quot; of the object &quot;s&quot;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="bu">std::</span>cout <span class="op">&lt;&lt;</span> s<span class="op">.</span>size<span class="op">()</span> <span class="op">&lt;&lt;</span> <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span>  <span class="co">// This prints &quot;5&quot;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>In Crystal, a syntax like <code>s.size()</code> is extended to
<em>any</em> value, including literals (and you can avoid empty
parenthesis):</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Since &quot;Hello&quot; is an object, you can call the method &quot;size&quot;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># directly on it</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">puts</span> <span class="st">&quot;Hello&quot;</span><span class="at">.size</span>    <span class="co"># This prints &quot;5&quot;</span></span></code></pre></div>
<p>This characteristic has been mutuated by Ruby, whose design strive to
achieve the maximum elegance. In fact, instead of having
<code>for</code> loops, Crystal (and Ruby) define the method
<code>each</code> on container objects, i.e., variables that contain
collections of objects:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode ruby"><code class="sourceCode ruby"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The method &quot;each&quot; is called on the list of strings</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">[</span><span class="st">&quot;Strong force&quot;</span>, <span class="st">&quot;Weak force&quot;</span><span class="kw">]</span><span class="at">.each</span> <span class="cf">do</span> <span class="kw">|</span>value<span class="kw">|</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">puts</span> value</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="cf">end</span></span></code></pre></div>
<p>This way of writing code is used pervasively in Ruby and Crystal, and
it lets to produce very compact and elegant programs.</p></li>
<li><p>A nice introduction to the language is available in the <a
href="https://crystal-lang.org/reference/1.5/getting_started/">online
manual</a>. If you prefer to learn Crystal using a textbook, <a
href="https://www.packtpub.com/product/crystal-programming/9781801818674"><em>Crystal
Programming</em></a>, by G. Dietrich and G. Bernal (Packt) is a more
in-depth explanation of the way Crystal works.</p></li>
<li><p>If you pick Crystal consider that it is a young and not
widespread language; this implies that editor support is not as good as
for other mainstream languages (C++, C#, Java, Kotlin…) and that you’re
less likely to find help using Google or <a
href="https://stackoverflow.com/">StackOverflow</a>. But you can rely on
the <a href="https://forum.crystal-lang.org/">Crystal forum</a> if you
need help!</p></li>
<li><p>The Crystal compiler comes with <a
href="https://crystal-lang.org/reference/1.5/man/shards/index.html">Shards</a>,
a tool that lets to compile programs and download and install libraries
automatically. There is no need to use makefiles if you use Crystal!</p>
<p>For instance, to create a new application you write</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> crystal init app myapp</span></code></pre></div>
<p>and a new folder <code>myapp</code> is populated with a number of
files. To compile all the files in the <code>myapp</code> folder and run
the executable, you just write</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode sh"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cd myapp</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> shards run</span></code></pre></div>
<p>and all the source files will be compiled to build an executable,
which is then automatically run without the need to write a
<code>Makefile</code>.</p></li>
<li><p>Till today, Crystal is not <a
href="https://crystal-lang.org/install/on_windows/">fully functional on
Windows</a>. You can check the progress on <a
href="https://github.com/crystal-lang/crystal/projects/6#card-16297567">this
page</a>: at the time of writing, it seems that things are converging,
but full support is not here yet. However, you can probably circumvent
this limitation if you use the <a
href="https://learn.microsoft.com/en-us/windows/wsl/install">Windows
WSL</a>.</p></li>
</ul>
<p>The teacher believes that Crystal is a nearly perfect language to be
used for this course. However, like Nim you must be prepared to cope
with the parcity of documentation and the lack of a full IDE.</p>
<h1 id="c-1">C#</h1>
<p>The C# (pron. «C sharp») language has been developed by a Microsoft
team lead by Anders Hejlsberg; its first release dates back to 2000. The
aim of the team was to implement a «saner» version of the C and C++
languages, which explains the multiple puns in the name:</p>
<ul>
<li>The sharp sign <code>#</code> can be seen as two <code>++</code> one
atop the other, suggesting that C# is an improvement over C++;</li>
<li>In anglophone countries, C# is the note immediately above C.</li>
<li>«Sharp» can be used as a synonym for «cool», «smart», etc.</li>
</ul>
<p>Unlike C++, C# adopts a OOP-centered approach. It does not aim to be
100% compatible with C++, which has enabled its designers to get rid of
some of the complexities of the latter.</p>
<p>Under the hood, the way C# programs are executed differs
significantly from C++, because they are run in a <em>managed</em>
environment: the compiler translates the program to a low-level
representation, which is then run by another program, called the
<em>Common Language Runtime</em> (CLR). The purpose of the CLR is to
translate the low-level representation into actual machine instructions
that are sent to the CPU. This is in contrast with the way traditional
compilers work: GCC and Clang translate the program directly to CPU
instructions at compilation time.</p>
<p>Although the managed approach might seem slower to execute because of
the on-the-fly translation made by the CLR to actually execute the code,
the CLR implements a number of optimizations that make its performance
similar to C++. In particular, the CLR measures the way the code is used
during the execution and can re-generate CPU instructions according to
what it has learnt<a href="#fn5" class="footnote-ref" id="fnref5"
role="doc-noteref"><sup>5</sup></a>. Because of this, a program running
in a managed environment requires some time to optimize itself (the
so-called <em>burn-in phase</em>), but then after some time spent
running it can be as performant as C++. In the tests I did while
preparing the material for this course, the C# compiler was able to
produce programs whose performance was always very close to C++’s.</p>
<p>Here is an example showing how to implement a basic <code>Vec</code>
class in C#. Note that, despite a few differences, the syntax looks very
similar to C++’s:</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">struct</span> Vec <span class="op">{</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">double</span> x<span class="op">,</span> y<span class="op">,</span> z<span class="op">;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">Vec</span><span class="op">(</span><span class="dt">double</span> _x<span class="op">,</span> <span class="dt">double</span> _y<span class="op">,</span> <span class="dt">double</span> _z<span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">x</span> <span class="op">=</span> _x<span class="op">;</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">y</span> <span class="op">=</span> _y<span class="op">;</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">z</span> <span class="op">=</span> _z<span class="op">;</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">static</span> <span class="kw">implicit</span> <span class="kw">operator</span> <span class="dt">string</span> <span class="op">(</span>Vec v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="dt">string</span><span class="op">.</span><span class="fu">Format</span><span class="op">(</span><span class="st">&quot;&lt;{0}, {1}, {2}&gt;&quot;</span><span class="op">,</span> v<span class="op">.</span><span class="fu">x</span><span class="op">,</span> v<span class="op">.</span><span class="fu">y</span><span class="op">,</span> v<span class="op">.</span><span class="fu">z</span><span class="op">);</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">static</span> Vec <span class="kw">operator</span> <span class="op">*(</span><span class="dt">double</span> t<span class="op">,</span> Vec v<span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="kw">new</span> <span class="fu">Vec</span><span class="op">(</span>t <span class="op">*</span> v<span class="op">.</span><span class="fu">x</span><span class="op">,</span> t <span class="op">*</span> v<span class="op">.</span><span class="fu">y</span><span class="op">,</span> t <span class="op">*</span> v<span class="op">.</span><span class="fu">z</span><span class="op">);</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="kw">static</span> <span class="dt">double</span> <span class="kw">operator</span> <span class="op">*(</span>Vec a<span class="op">,</span> Vec b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> a<span class="op">.</span><span class="fu">x</span> <span class="op">*</span> b<span class="op">.</span><span class="fu">x</span> <span class="op">+</span> a<span class="op">.</span><span class="fu">y</span> <span class="op">*</span> b<span class="op">.</span><span class="fu">y</span> <span class="op">+</span> a<span class="op">.</span><span class="fu">z</span> <span class="op">*</span> b<span class="op">.</span><span class="fu">z</span><span class="op">;</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>C# provides a few high-level functionalities with respect to C++. One
of these is first-class string support, which means that converting a
vector into a string can make use of the handy
<code>string.Format</code> class, instead of relying on the cumbersome
<code>std::stringstream</code> class. Note that, unlike C++, C# does not
force the programmer to remember when to use <code>;</code> after a
closing brace <code>}</code>.</p>
<p>To access the data members of a class, you must explicitly reference
them using <code>this</code>; this is similar to the <code>self</code>
parameter in the Python language.</p>
<p>Defining rays and spheres is similar:</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode cs"><code class="sourceCode cs"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">struct</span> Ray <span class="op">{</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Vec m_o<span class="op">,</span> m_d<span class="op">;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">double</span> m_tmin<span class="op">,</span> m_tmax<span class="op">;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">Ray</span><span class="op">(</span>Vec _o<span class="op">,</span> Vec _d<span class="op">)</span> <span class="op">{</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">m_o</span> <span class="op">=</span> _o<span class="op">;</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">m_d</span> <span class="op">=</span> _d<span class="op">;</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>        m_tmin <span class="op">=</span> <span class="fl">1e-10</span><span class="op">;</span></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>        m_tmax <span class="op">=</span> <span class="fl">1e10</span><span class="op">;</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">struct</span> Sphere <span class="op">{</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Vec m_p<span class="op">;</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">double</span> m_r<span class="op">;</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">Sphere</span><span class="op">(</span>Vec _p<span class="op">,</span> <span class="dt">double</span> _r<span class="op">)</span> <span class="op">{</span> <span class="kw">this</span><span class="op">.</span><span class="fu">m_p</span> <span class="op">=</span> _p<span class="op">;</span> <span class="kw">this</span><span class="op">.</span><span class="fu">m_r</span> <span class="op">=</span> _r<span class="op">;</span> <span class="op">}</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">bool</span> <span class="fu">Intersect</span><span class="op">(</span>Ray r<span class="op">)</span> <span class="op">{</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>        Vec op <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">m_p</span> <span class="op">-</span> r<span class="op">.</span><span class="fu">m_o</span><span class="op">;</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">double</span> dop <span class="op">=</span> r<span class="op">.</span><span class="fu">m_d</span> <span class="op">*</span> op<span class="op">;</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">double</span> D <span class="op">=</span> dop <span class="op">*</span> dop <span class="op">-</span> op <span class="op">*</span> op <span class="op">+</span> m_r <span class="op">*</span> m_r<span class="op">;</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(</span><span class="fl">0.0</span> <span class="op">&gt;</span> D<span class="op">)</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>        <span class="dt">double</span> sqrtD <span class="op">=</span> Math<span class="op">.</span><span class="fu">Sqrt</span><span class="op">(</span>D<span class="op">);</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>        <span class="dt">double</span> tmin <span class="op">=</span> dop <span class="op">-</span> sqrtD<span class="op">;</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span><span class="op">(</span>r<span class="op">.</span><span class="fu">m_tmin</span> <span class="op">&lt;</span> tmin <span class="op">&amp;&amp;</span> tmin <span class="op">&lt;</span> r<span class="op">.</span><span class="fu">m_tmax</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>        <span class="dt">double</span> tmax <span class="op">=</span> dop <span class="op">+</span> sqrtD<span class="op">;</span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> r<span class="op">.</span><span class="fu">m_tmin</span> <span class="op">&lt;</span> tmax <span class="op">&amp;&amp;</span> tmax <span class="op">&lt;</span> r<span class="op">.</span><span class="fu">m_tmax</span><span class="op">;</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Here are a few advantages of C# over C++:</p>
<ul>
<li><p>It is similar to C++, yet it is considerably easier:</p>
<ul>
<li><p>No weird syntax rules dealing with missing <code>;</code> and
uniform initializers;</p></li>
<li><p>No pointers;</p></li>
<li><p>No multiple inheritance;</p></li>
<li><p>Easy, lightweight inheritance through
<em>interfaces</em>;</p></li>
<li><p>No need to call <code>delete</code> on objects allocated with
<code>new</code>, as the compiler figures when to call it by
itself;</p></li>
<li><p>Easy way to implement getters and setters (i.e., the
<code>SetA()</code>/<code>GetA()</code> methods that are widely used in
OOP C++ codes) through <em>properties</em>.</p></li>
</ul></li>
<li><p>It is extremely easy to develop new projects, as the C#
environment can take care of creating a directory structure and project,
compiling it, running tests, download libraries from internet, etc.
There is no need to write a <code>Makefile</code>!</p>
<p>For instance, to create a new program in the directory
<code>myprog</code>, after you have installed .NET, you just type the
following:</p>
<pre><code>$ dotnet new console -o myprog</code></pre>
<p>(The <code>console</code> flag tells <code>dotnet</code> that the
program will run from the command line, instead of providing a windowed
graphical user interface.)</p>
<p>To compile the program, there is no need to write a
<code>Makefile</code>. Just type</p>
<pre><code>$ dotnet run</code></pre>
<p>within the <code>myprog</code> directory, and the program will be
compiled and executed automatically.</p></li>
<li><p>The standard library provided by C# is very complete, and several
other libraries can be easily downloaded from the Internet using the
<code>dotnet</code> command. (This is particularly handy for this
course, as you will be asked to employ external libraries to save images
in PNG/JPEG formats!)</p></li>
<li><p>There is very good IDE support: the best in the class is surely
Rider (<a
href="https://www.jetbrains.com/rider/">www.jetbrains.com/rider/</a>),
whose «Community edition» can be downloaded for free. Visual Studio Code
(<a href="https://code.visualstudio.com/">code.visualstudio.com</a>) is
a good second choice, although not as powerful.</p></li>
<li><p>The C# language is widely used, and there are several online
resources. The <a
href="https://docs.microsoft.com/en-us/dotnet/csharp/">Reference
Documentation</a> published by Microsoft is particularly good. A short
and clear textbook is <em>C# in a nutshell</em>, by Joseph and Ben
Albahari (O’Reilly).</p></li>
<li><p>Microsoft has recently released the <a
href="https://dotnet.microsoft.com/">.NET8 platform</a>, which is easy
to install and shows impressive performance.</p></li>
<li><p>If you have the hobby of developing videogames, C# is for you!
The <a
href="https://en.wikipedia.org/wiki/Unity_(game_engine)">Unity</a> game
engine is an industrial standard in videogame programming and uses C# as
its scripting language. <a
href="https://en.wikipedia.org/wiki/List_of_Unity_games#2019">Several
blockbusters</a> have been developed using it.</p></li>
</ul>
<p>The experience of students using C# for this course has been
extremely positive so far.</p>
<h1 id="d">D</h1>
<p>The D language is the creation of <a
href="https://en.wikipedia.org/wiki/Walter_Bright">Walter Bright</a>,
which authored one of the most famous C++ compilers available in the
’90: the Zortech C++ compiler (later called the <a
href="https://en.wikipedia.org/wiki/Digital_Mars">Digital Mars</a> C++
compiler). Bright was dissatisfied with the direction taken by the C++
committee, and he decided to develop a new language that was based on C
but did not strive to maintain compatibility with it (unlike C++). The
result is a more «modern» and elegant language, which however has not
reached the same level of adoption as C++.</p>
<p>Unlike C++, D does not uses header files, as these are notoriously
error-prone; rather, it use <em>modules</em>, which work similarly to
Python:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode d"><code class="sourceCode d"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="pp">import</span><span class="im"> std.stdio</span><span class="op">;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="pp">import</span><span class="im"> std.format</span><span class="op">;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="pp">import</span><span class="im"> std.array</span><span class="op">;</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="pp">import</span><span class="im"> std.algorithm.searching</span><span class="op">;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="pp">import</span><span class="im"> std.math</span><span class="op">;</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="pp">import</span><span class="im"> std.random</span><span class="op">;</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="pp">import</span><span class="im"> std.datetime.stopwatch</span><span class="op">;</span></span></code></pre></div>
<p>Constants can be defined exactly like in C++:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode d"><code class="sourceCode d"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">const</span> <span class="dt">double</span> DEFAULT_TMIN <span class="op">=</span> <span class="fl">1e-10</span><span class="op">;</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">const</span> <span class="dt">double</span> DEFAULT_TMAX <span class="op">=</span> <span class="fl">1e+10</span><span class="op">;</span></span></code></pre></div>
<p>Things get interesting when you define a new <code>struct</code> or
<code>class</code>:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode d"><code class="sourceCode d"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="wa">struct</span> Vec <span class="op">{</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> x<span class="op">;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> y<span class="op">;</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> z<span class="op">;</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">// This is a template over the type W</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">void</span> toString<span class="op">(</span>W<span class="op">)(</span><span class="fu">ref</span> W writer<span class="op">,</span> <span class="fu">scope</span> <span class="fu">const</span> <span class="fu">ref</span> FormatSpec<span class="op">!</span><span class="dt">char</span> f<span class="op">)</span> <span class="fu">const</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>       <span class="kw">if</span> <span class="op">(</span>isOutputRange<span class="op">!(</span>W<span class="op">,</span> <span class="dt">char</span><span class="op">))</span> <span class="co">// Template constraint</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>         <span class="op">{</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>           put<span class="op">(</span>writer<span class="op">,</span> <span class="st">&quot;&lt;&quot;</span><span class="op">);</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>           formatValue<span class="op">(</span>writer<span class="op">,</span> x<span class="op">,</span> f<span class="op">);</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>           put<span class="op">(</span>writer<span class="op">,</span> <span class="st">&quot;, &quot;</span><span class="op">);</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>           formatValue<span class="op">(</span>writer<span class="op">,</span> y<span class="op">,</span> f<span class="op">);</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>           put<span class="op">(</span>writer<span class="op">,</span> <span class="st">&quot;, &quot;</span><span class="op">);</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>           formatValue<span class="op">(</span>writer<span class="op">,</span> z<span class="op">,</span> f<span class="op">);</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>           put<span class="op">(</span>writer<span class="op">,</span> <span class="st">&quot;&gt;&quot;</span><span class="op">);</span></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>         <span class="op">}</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Another template</span></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> opBinary<span class="op">(</span><span class="bu">string</span> op<span class="op">)(</span><span class="fu">const</span> <span class="fu">ref</span> Vec other<span class="op">)</span> <span class="fu">const</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>       <span class="kw">if</span><span class="op">(</span>op <span class="op">==</span> <span class="st">&quot;*&quot;</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>         <span class="kw">return</span> x <span class="op">*</span> other.x <span class="op">+</span> y <span class="op">*</span> other.y <span class="op">+</span> z <span class="op">*</span> other.z<span class="op">;</span></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>       <span class="op">}</span></span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>  Vec opBinary<span class="op">(</span><span class="bu">string</span> op<span class="op">)(</span><span class="dt">double</span> t<span class="op">)</span> <span class="fu">const</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>       <span class="kw">if</span><span class="op">(</span>op <span class="op">==</span> <span class="st">&quot;*&quot;</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>         <span class="kw">return</span> Vec<span class="op">(</span>t <span class="op">*</span> x<span class="op">,</span> t <span class="op">*</span> y<span class="op">,</span> t <span class="op">*</span> z<span class="op">);</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>       <span class="op">}</span></span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Here we use a &quot;mixin&quot;: a string that is interpreted at compile</span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>  <span class="co">// time and substituted as a line of code. The &quot;~&quot; operator</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>  <span class="co">// concatenates strings.</span></span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>  Vec opBinary<span class="op">(</span><span class="bu">string</span> op<span class="op">)(</span><span class="fu">const</span> <span class="fu">ref</span> Vec other<span class="op">)</span> <span class="fu">const</span></span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>       <span class="kw">if</span> <span class="op">(</span>op <span class="op">==</span> <span class="st">&quot;+&quot;</span> <span class="op">||</span> op <span class="op">==</span> <span class="st">&quot;-&quot;</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>         <span class="kw">return</span> <span class="kw">mixin</span><span class="op">(</span><span class="st">&quot;Vec(x &quot;</span> <span class="op">~</span> op <span class="op">~</span> <span class="st">&quot; other.x, &quot;</span> <span class="op">~</span></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;y &quot;</span> <span class="op">~</span> op <span class="op">~</span> <span class="st">&quot; other.y, &quot;</span> <span class="op">~</span></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>                      <span class="st">&quot;z &quot;</span> <span class="op">~</span> op <span class="op">~</span> <span class="st">&quot; other.z)&quot;</span><span class="op">);</span></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>       <span class="op">}</span></span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The syntax <code>struct Vec...</code> is clearly derived from C++,
but templates use a different syntax: instead of writing</p>
<div class="sourceCode" id="cb32"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span><span class="kw">typename</span> W<span class="op">&gt;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> toString<span class="op">(</span>W <span class="op">&amp;</span> writer<span class="op">,</span> <span class="at">const</span> FormatSpec<span class="op">&lt;</span><span class="dt">char</span><span class="op">&gt;</span> <span class="op">&amp;</span> f<span class="op">)</span> <span class="at">const</span></span></code></pre></div>
<p>in D you write this</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode d"><code class="sourceCode d"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> toString<span class="op">(</span>W<span class="op">)(</span><span class="fu">ref</span> W writer<span class="op">,</span> <span class="fu">scope</span> <span class="fu">const</span> <span class="fu">ref</span> FormatSpec<span class="op">!</span><span class="dt">char</span> f<span class="op">)</span> <span class="fu">const</span></span></code></pre></div>
<p>When you <em>declare</em> a template, you put the template names
within parentheses, like <code>(W)</code>, but when you <em>use</em> an
existing template, you put the template parameters after the
<code>!</code> character. When we will explain the theory of compilers
at the end of the course, we will learn why the D syntax is much more
convenient to parse, but at the moment you should just accept this
difference.</p>
<p>Operator overloading works differently from C++, because it does not
force you to re-define several operators that all look alike:</p>
<div class="sourceCode" id="cb34"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co">// This is the same C++ code we saw before</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="op">[[</span><span class="at">nodiscard</span><span class="op">]]</span> <span class="kw">constexpr</span> Vec <span class="kw">operator</span><span class="op">+(</span><span class="at">const</span> Vec <span class="op">&amp;</span>a<span class="op">,</span> <span class="at">const</span> Vec <span class="op">&amp;</span>b<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Vec<span class="op">(</span>a<span class="op">.</span>x <span class="op">+</span> b<span class="op">.</span>x<span class="op">,</span> a<span class="op">.</span>y <span class="op">+</span> b<span class="op">.</span>y<span class="op">,</span> a<span class="op">.</span>z <span class="op">+</span> b<span class="op">.</span>z<span class="op">);</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co">// This is almost the same as operator+: boring!</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="op">[[</span><span class="at">nodiscard</span><span class="op">]]</span> <span class="kw">constexpr</span> Vec <span class="kw">operator</span><span class="op">-(</span><span class="at">const</span> Vec <span class="op">&amp;</span>a<span class="op">,</span> <span class="at">const</span> Vec <span class="op">&amp;</span>b<span class="op">)</span> <span class="kw">noexcept</span> <span class="op">{</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Vec<span class="op">(</span>a<span class="op">.</span>x <span class="op">-</span> b<span class="op">.</span>x<span class="op">,</span> a<span class="op">.</span>y <span class="op">-</span> b<span class="op">.</span>y<span class="op">,</span> a<span class="op">.</span>z <span class="op">-</span> b<span class="op">.</span>z<span class="op">);</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>In D, binary operators like <span class="math inline">+</span> and
<span class="math inline">−</span> are overloaded by the same template
function <code>opBinary(string op)</code>; in C++, this would probably
look like the following:</p>
<div class="sourceCode" id="cb35"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">template</span><span class="op">&lt;</span>std<span class="op">:</span>string op<span class="op">&gt;</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="kw">constexpr</span> Vec opBinary<span class="op">(</span><span class="at">const</span> Vec <span class="op">&amp;</span>a<span class="op">,</span> <span class="at">const</span> Vec <span class="op">&amp;</span>b<span class="op">)</span></span></code></pre></div>
<p>If C++ worked like D, the C++ compiler would translate
<code>a + b</code> into <code>opBinary&lt;"+"&gt;(a, b)</code> (still
using the C++ syntax) instead of the usual <code>operator+(a, b)</code>.
The approach followed by D reveals its strengths when used with
<em>mixins</em>, which is a way to tell the compiler to generate source
code using string interpolation functions:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode d"><code class="sourceCode d"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>Vec opBinary<span class="op">(</span><span class="bu">string</span> op<span class="op">)(</span><span class="fu">const</span> <span class="fu">ref</span> Vec other<span class="op">)</span> <span class="fu">const</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>     <span class="kw">if</span> <span class="op">(</span>op <span class="op">==</span> <span class="st">&quot;+&quot;</span> <span class="op">||</span> op <span class="op">==</span> <span class="st">&quot;-&quot;</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>       <span class="kw">return</span> <span class="kw">mixin</span><span class="op">(</span><span class="st">&quot;Vec(x &quot;</span> <span class="op">~</span> op <span class="op">~</span> <span class="st">&quot; other.x, &quot;</span> <span class="op">~</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;y &quot;</span> <span class="op">~</span> op <span class="op">~</span> <span class="st">&quot; other.y, &quot;</span> <span class="op">~</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>                    <span class="st">&quot;z &quot;</span> <span class="op">~</span> op <span class="op">~</span> <span class="st">&quot; other.z)&quot;</span><span class="op">);</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>     <span class="op">}</span></span></code></pre></div>
<p>The strange-looking <code>if</code> placed <em>before</em> the braces
(<code>{}</code>, which is something not admitted in C++) is a
<em>template constraint</em>: it tells that the template should not be
applied for <em>any</em> string passed to <code>op</code>, but only if
the string is either <code>"+"</code> or <code>"-"</code>. The
<code>~</code> operator means string concatenation (this is unlike C++,
where you concatenate <code>std::string</code> objects using
<code>+</code>), and the code</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode d"><code class="sourceCode d"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">mixin</span><span class="op">(</span><span class="st">&quot;Vec(x &quot;</span> <span class="op">~</span> op <span class="op">~</span> <span class="st">&quot; other.x, &quot;</span> <span class="op">~</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;y &quot;</span> <span class="op">~</span> op <span class="op">~</span> <span class="st">&quot; other.y, &quot;</span> <span class="op">~</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;z &quot;</span> <span class="op">~</span> op <span class="op">~</span> <span class="st">&quot; other.z)&quot;</span><span class="op">);</span></span></code></pre></div>
<p>tells the compiler to do the following steps:</p>
<ol type="1">
<li><p>Calculate the concatenation of the strings; if
<code>op == "+"</code>, the result is</p>
<div class="sourceCode" id="cb38"><pre
class="sourceCode d"><code class="sourceCode d"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;Vec(x + other.x, y + other.y, z + other.z)&quot;</span></span></code></pre></div></li>
<li><p>Put the string as if it were a true line of code at the spot
where the <code>mixin</code> was used; again, if <code>op == "+"</code>
then the result is</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode d"><code class="sourceCode d"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>Vec opBinary<span class="op">(</span><span class="bu">string</span> op<span class="op">)(</span><span class="fu">const</span> <span class="fu">ref</span> Vec other<span class="op">)</span> <span class="fu">const</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>     <span class="kw">if</span> <span class="op">(</span>op <span class="op">==</span> <span class="st">&quot;+&quot;</span> <span class="op">||</span> op <span class="op">==</span> <span class="st">&quot;-&quot;</span><span class="op">)</span> <span class="op">{</span> <span class="co">// We assume now that op == &quot;+&quot;</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>       <span class="kw">return</span> Vec<span class="op">(</span>x <span class="op">+</span> other.x<span class="op">,</span> y <span class="op">+</span> other.y<span class="op">,</span> z <span class="op">+</span> other.z<span class="op">);</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>     <span class="op">}</span></span></code></pre></div>
<p>but of course this is done in the same way if
<code>op == "-"</code>.</p></li>
</ol>
<p>This combination of <code>opBinary</code> and mixins is extremely
useful for the purpose of this course, as we will need to define a
number of unary/binary operations on data types. Doing this in C++ is
quite boring, but in D the task is much simplified.</p>
<p>The definition of <code>Sphere</code>, <code>Ray</code>, and
<code>intersect</code> should be trivial to follow:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode d"><code class="sourceCode d"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="wa">struct</span> Ray <span class="op">{</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  Vec origin<span class="op">;</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  Vec dir<span class="op">;</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> tmin<span class="op">;</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> tmax<span class="op">;</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Constructors in D are named as &quot;this&quot;; in C++ this should</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">// have been</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">//</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">//     Ray(Vec or, Vec d…)</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">//</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">this</span><span class="op">(</span>Vec or<span class="op">,</span> Vec d<span class="op">,</span> <span class="dt">double</span> tmin <span class="op">=</span> DEFAULT_TMIN<span class="op">,</span> <span class="dt">double</span> tmax <span class="op">=</span> DEFAULT_TMAX<span class="op">)</span> <span class="op">{</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">this</span>.origin <span class="op">=</span> or<span class="op">;</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">this</span>.dir <span class="op">=</span> d<span class="op">;</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">this</span>.tmin <span class="op">=</span> tmin<span class="op">;</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">this</span>.tmax <span class="op">=</span> tmax<span class="op">;</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="wa">struct</span> Sphere <span class="op">{</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>  Vec center<span class="op">;</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>  <span class="dt">double</span> radius<span class="op">;</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a><span class="dt">bool</span> intersect<span class="op">(</span><span class="fu">ref</span> Sphere sphere<span class="op">,</span> <span class="fu">ref</span> Ray ray<span class="op">)</span> <span class="op">{</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">const</span> Vec op <span class="op">=</span> sphere.center <span class="op">-</span> ray.origin<span class="op">;</span></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">const</span> <span class="dt">double</span> dop <span class="op">=</span> ray.dir <span class="op">*</span> op<span class="op">;</span></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">const</span> <span class="dt">double</span> D <span class="op">=</span> dop <span class="op">*</span> dop <span class="op">-</span> op <span class="op">*</span> op <span class="op">+</span> sphere.radius <span class="op">*</span> sphere.radius<span class="op">;</span></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> <span class="op">(</span><span class="dv">0</span> <span class="op">&gt;</span> D<span class="op">)</span> <span class="op">{</span></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="at">false</span><span class="op">;</span></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">const</span> <span class="dt">double</span> sqrtD <span class="op">=</span> sqrt<span class="op">(</span>D<span class="op">);</span></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">const</span> <span class="dt">double</span> tmin <span class="op">=</span> dop <span class="op">-</span> sqrtD<span class="op">;</span></span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> <span class="op">(</span>ray.tmin <span class="op">&lt;</span> tmin <span class="op">&amp;&amp;</span> tmin <span class="op">&lt;</span> ray.tmax<span class="op">)</span> <span class="op">{</span></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="at">true</span><span class="op">;</span></span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">const</span> <span class="dt">double</span> tmax <span class="op">=</span> dop <span class="op">+</span> sqrtD<span class="op">;</span></span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>  <span class="kw">if</span> <span class="op">(</span>ray.tmin <span class="op">&lt;</span> tmax <span class="op">&amp;&amp;</span> tmax <span class="op">&lt;</span> ray.tmin<span class="op">)</span> <span class="op">{</span></span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="at">true</span><span class="op">;</span></span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>  <span class="op">}</span></span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>  <span class="kw">return</span> <span class="at">false</span><span class="op">;</span></span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Here are a few advantages of D:</p>
<ul>
<li><p>If you know C++, most of the syntax of D will look
familiar.</p></li>
<li><p>The ability to manipulate the code using templates and mixins is
more powerful than C++ and at the same time easier to grasp than C++
templates.</p></li>
<li><p>There are <em>three</em> good D compilers:</p>
<ol type="1">
<li><p>The DMD compiler is the first D compiler, released by Walter
Bright and regularly maintained. It compiles code quickly and has a nice
command-line interface, but it produces slow executables, so it is only
good for debugging.</p></li>
<li><p>The GCC compiler supports D through the command-line program
<code>gdc</code> (which you should probably install separately, as by
default GCC only installs support for C and C++). Since the code
generator is the same as <code>g++</code>, the speed of executables
written in D and compiled with <code>gdc</code> is the same as C++
programs compiled with <code>g++</code> (which means that they run very
fast!).</p></li>
<li><p>Finally, the LDC compiler is based on LLVM and thus uses the same
technology as the Clang compiler (the default C++ compiler on Mac OS X)
and the Rust compiler (see below).</p></li>
</ol></li>
<li><p>D uses a sane approach for floating-point computation, as it sets
uninitialized floating-point variables to <code>NaN</code>: this eases
debugging, as it is immediately clear if you forgot to initialize a
<code>double</code>!</p></li>
<li><p>There is good support for editors; Visual Studio Code should be
your first choice (although I prefer writing D programs in
Emacs…).</p></li>
<li><p>There is no need to use a <code>Makefile</code>, as D uses a
package/build manager named <code>dub</code>.</p></li>
</ul>
<p>There are a few disadvantages too:</p>
<ul>
<li><p>The amount of on-line resources is far scarcer than for
C++.</p></li>
<li><p>The language has evolved a lot in the last years, and it is still
evolving. Many pages in the documentation refers to old practices and
conventions, and you should probably refer to the <a
href="https://forum.dlang.org/">D language forum</a> to learn if there
is some better way to implement what you have in mind. (Unfortunately,
the D community itself is often not sure about what language features
are the best ones to use depending on the problem. This has been a cause
of confusion for students!)</p></li>
<li><p>Last year, my own students have stumbled upon bugs in the D
compiler itself, which refused to compile perfectly valid code.</p></li>
<li><p>A quite important library needed for the course,
<code>std.stream</code>, <a
href="https://forum.dlang.org/thread/qpilvmprtyqxmyladkdq@forum.dlang.org">has
been deprecated</a>, but no alternative still exist to cope with this
deficiency. In past years, students using D had to develop their own
stream routines or force the compiler to use the deprecated library
(which is however risky!).</p></li>
</ul>
<p>A few good resources to learn D:</p>
<ul>
<li><p><em>Programming in D: tutorial and reference</em>, by Ali Çereli,
is <a href="https://ddili.org/ders/d.en/index.html">available
online</a>. It is a comprehensive book that teaches <em>everything</em>
about D.</p></li>
<li><p><em>The D programming language</em>, by Andrei Alexandrescu
(2010, Addison-Wesley), is unfortunately dated, as D evolved a lot in
the last years. Still, this is by far one of the best programming book
not only for the D language but in general: Alexandrescu is a gifted
writer, and the book is full of intriguing examples. Despite its age, it
is a real gem.</p></li>
</ul>
<p>D could be the perfect language for this course, because it’s
significantly better than C++ and easier to use. However, the scattered
and sometimes contradictory documentation can be a barrier for students
willing to use it.</p>
<h1 id="free-pascal">Free Pascal</h1>
<p>Pascal is one of the most venerable languages listed in this
document. It was developed by prof. Niklaus Wirth in 1970, but it raised
to widespread use only when in the 1980s Borland International produced
and commercialized the Turbo Pascal<a href="#fn6" class="footnote-ref"
id="fnref6" role="doc-noteref"><sup>6</sup></a> compiler. Wirth
developed the Pascal language as a tool to teach programming to
students, which means that the language is meant to be easy to learn and
teaches good programming practices. It was used to develop Apple Mac
OS<a href="#fn7" class="footnote-ref" id="fnref7"
role="doc-noteref"><sup>7</sup></a> at least until version 6 (after
that, Pascal fell out of fashion and Apple slowly rewrote parts of it in
C).</p>
<p>Today one of the most used Pascal compilers is FreePascal (<a
href="https://freepascal.org/">freepascal.org</a>), which implements
several new features in addition to the basic Pascal language proposed
by Wirth.</p>
<p>Unlike C++, Pascal uses verbose keywords in place of symbols: for
instance, instead of writing <code>{</code> and <code>}</code>, Pascal
requires <code>begin</code> and <code>end</code>, and instead of
<code>&amp;&amp;</code> and <code>||</code> it uses <code>and</code> and
<code>or</code>.</p>
<p>To define new data types, you must start with the <code>type</code>
keyword; a C++ <code>struct</code> corresponds to a <code>record</code>
in Pascal. Here is the implementation of the <code>Vec</code> class:</p>
<div class="sourceCode" id="cb41"><pre
class="sourceCode pascal"><code class="sourceCode pascal"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">uses</span> strutils;   <span class="co">(* This imports the &quot;Format&quot; function *)</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>   Vec = <span class="kw">record</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>      x, y, z: <span class="dt">Real</span>;</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>   <span class="kw">end</span>;</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> FormatVec(<span class="kw">const</span> v : Vec) : <span class="dt">String</span>;</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="kw">begin</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>   result := Format(<span class="st">&#39;&lt;%.2f, %.2f, %.2f&gt;&#39;</span>, [v.x, v.y, v.z]);</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>;</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="kw">operator</span> * (t : <span class="dt">Real</span>; <span class="kw">const</span> v : Vec) : Vec; <span class="kw">inline</span>;</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="kw">begin</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>   result.x := t * v.x;</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>   result.y := t * v.y;</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>   result.z := t * v.z;</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>;</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="kw">operator</span> * (<span class="kw">const</span> a, b : Vec) : <span class="dt">Real</span>; <span class="kw">inline</span>;</span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="kw">begin</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>   result := a.x * b.x + a.y * b.y + a.z * b.z;</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>;</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a><span class="kw">operator</span> * (a : <span class="dt">Real</span>; <span class="kw">const</span> v : Vec) : <span class="dt">Real</span>; <span class="kw">inline</span>;</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a><span class="kw">begin</span></span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>   result.x := a * v.x;</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>   result.y := a * v.y;</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>   result.z := a * v.z;</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>;</span></code></pre></div>
<p>Unlike C++, Pascal uses the <code>:=</code> operator to mark an
assignment; because of its didactic nature, Wirth wanted a language that
marked the difference in roles between the left and right sides of
expressions like <code>a := b</code> (where <code>a</code> gets modified
but not <code>b</code>).</p>
<p>Other notable differences with respect to C++ are the following:</p>
<ul>
<li><p>Instead of <code>{</code> and <code>}</code>, Pascal uses
<code>begin</code> and <code>end</code>.</p></li>
<li><p>In C++, function parameters are declared with the form
<code>type name</code>, e.g., <code>int a</code>. In Pascal, the type
comes <em>after</em> the name: <code>name: type</code>.</p></li>
</ul>
<p>A peculiarity of Pascal is that the language is case-insensitive: you
can either write <code>BEGIN</code>, <code>begin</code>,
<code>Begin</code>, and the compiler will accept any of these. (This can
be a feature to prevent sloppy students from defining variables named
<code>x</code> and <code>X</code> in the same function, as the compiler
will complain that the same variable is defined twice!)</p>
<p>The ability to define custom operators has been added by the
FreePascal compiler; the original Pascal language did not have this
feature.</p>
<p>The code to intersect rays and spheres is defined similarly:</p>
<div class="sourceCode" id="cb42"><pre
class="sourceCode pascal"><code class="sourceCode pascal"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>   Ray = <span class="kw">record</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>      m_o : Vec;</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>      m_d : Vec;</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>      m_tmin : <span class="dt">Real</span>;</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>      m_tmax : <span class="dt">Real</span>;</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>   <span class="kw">end</span>;</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>   Sphere = <span class="kw">record</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>      m_p : Vec;</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>      m_r : <span class="dt">Real</span>;</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>   <span class="kw">end</span>;</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> intersect(sphere: Sphere; ray: Ray) : <span class="dt">Boolean</span>;</span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="kw">var</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>   op : Vec;</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>   dop : <span class="dt">Real</span>;</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>   D : <span class="dt">Real</span>;</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>   sqrtD : <span class="dt">Real</span>;</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>   tmin, tmax : <span class="dt">Real</span>;</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a><span class="kw">begin</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>   op := sphere.m_p - ray.m_o;</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a>   dop := ray.m_d * op;</span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>   D := dop * dop - op * op + sphere.m_r * sphere.m_r;</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a>   <span class="kw">if</span> <span class="dv">0</span> &gt; D <span class="kw">then</span></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>      <span class="kw">Exit</span>(<span class="kw">False</span>);</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>   sqrtD := sqrt(D);</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>   tmin := dop - sqrtD;</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>   <span class="kw">if</span> (ray.m_tmin &lt; tmin) <span class="kw">and</span> (tmin &lt; ray.m_tmax) <span class="kw">then</span></span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a>      <span class="kw">Exit</span>(<span class="kw">True</span>);</span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>   tmax := dop + sqrtD;</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>   result := (ray.m_tmin &lt; tmax) <span class="kw">and</span> (tmax &lt; ray.m_tmax);</span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span>;</span></code></pre></div>
<p>Unlike C++, Pascal requires to list the variables used in a function
in a <code>var</code> section before the <code>begin</code>, as shown in
the function <code>intersect</code>. The return value of a function can
be either assigned to the implicit variable <code>result</code> or
returned through the <code>Exit</code> procedure.</p>
<p>Here are a few advantages of FreePascal over C++:</p>
<ul>
<li><p>Because of a precise design choice by Wirth, the Pascal language
has been designed to be very quick to compile. In fact, it takes only a
few seconds to compile very large codebases (<span
class="math inline">10<sup>5</sup></span> lines of code and more), which
is at least one order of magnitude less than modern C++
compilers.</p></li>
<li><p>No need to use header files: the declaration and the
implementation of functions/classes is written in the same
file.</p></li>
<li><p>No need to use a <code>Makefile</code> to compile the code, as
FreePascal uses <a href="https://wiki.freepascal.org/Unit">units</a>,
which let the compiler decide on its own when files need to be
recompiled.</p></li>
<li><p>There is a very good IDE for FreePascal, Lazarus (<a
href="https://www.lazarus-ide.org/">www.lazarus-ide.org</a>).</p></li>
<li><p>Lazarus (see above) provides a very intuitive way to develop
graphical user applications. Although this is not required for the
course, students can take advantage of buttons, windows and other visual
elements to provide a more friendly interface to their program. See this
example, showing a program developed with Lazarus that is rendering a
coarse version of a 3D image using the techniques explained in this
course:</p>
<p><img src="pd-images/pathtracer-lazarus.png" /></p>
<p>The colored horizontal bar at the bottom indicates the percentage of
image that has been computed so far, and the controls on the right allow
the user to tune the input parameters used to render the image.</p>
<p>Developing this kind of graphical user applications is usually very
hard, but Lazarus makes this task straightforward. Have a look at the
video <a href="https://www.youtube.com/watch?v=kl4O5WGU-BQ">Lazarus
Tutorial #4 - The first calculator</a> for a nice example.</p></li>
</ul>
<p>There are a few disadvantages as well:</p>
<ul>
<li><p>Pascal tends to be a little verbose, and it lacks some high-level
constructs found in more recent languages.</p></li>
<li><p>The quality of the documentation available on the FreePascal site
is not fantastic.</p></li>
<li><p>Although much faster than interpreted languages like Python and
Ruby, FreePascal produces executables that are <span
class="math inline"> ∼ 10 %</span> slower than those produced by other
compilers.</p></li>
</ul>
<p>If you are interested in developing a graphical interface for the
program we will develop during this course, you should pick FreePascal
without hesitation, as <strong>no other language</strong> in this
document enables the same easiness in building a GUI.</p>
<p>A few references to learn FreePascal and Lazarus:</p>
<ul>
<li><p>To see how easy it is to build graphical interfaces in Lazarus,
you should watch the YouTube video <a
href="https://www.youtube.com/watch?v=kl4O5WGU-BQ">Lazarus Tutorial #4 -
The first calculator</a> (it is the fourth part in a series, but it is
the first one that shows how to use the GUI builder).</p></li>
<li><p>If you plan to use Lazarus to develop a graphical interface for
your program, you probably want to consult books written for <a
href="https://en.wikipedia.org/wiki/Delphi_(software)">Borland
Delphi</a>, which was Lazarus’ ancestor: Lazarus is still compatible
with Delphi, and so many of the stuff in any old book is still relevant.
A particularly good one is <em>Delphi developer’s guide</em> by Xavier
Pacheco and Steve Teixeira (Sams publishing, 1995). It is still
available on the web (e.g., on the <a
href="https://archive.org/details/Delphi_Developers_Guide_SAMS">Internet
Archive</a>), and most of what is explained there applies to Lazarus as
well.</p></li>
</ul>
<h1 id="freebasic">FreeBasic</h1>
<p>Together with Pascal, the BASIC language is one of the oldest
presented here, as its first implementation appeared in 1964. The name
BASIC stands for «Beginners’ All-purpose Symbolic Instruction Code»,
which stresses the fact that it is a language conceived for «beginners».
In the 1980s, it was a very common way to interact with personal
computers; the personal computers built by Commodore (Vic-20, C64, C128,
etc.) and the Sinclair ZX Spectrum greeted the user with a prompt where
BASIC commands could be issued directly:</p>
<p><img src="pd-images/c64-basic.png" style="width:67.0%" /></p>
<p>In the 1980s and 90s, a widely used BASIC compiler was Microsoft
BASIC PDS, together with Microsoft QuickBASIC (the latter was a
simplified edition of BASIC PDS). Microsoft introduced a number of
enhancements to the original BASIC language, and it included BASIC
compilers in its own operating system, MS-DOS (an ancestor of Windows).
The most advanced of these bundled BASIC compilers, QBasic<a href="#fn8"
class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a>,
was a stripped clone of Microsoft’s own QuickBasic, and the fact that it
was available on every computer running MS-DOS contributed to the
popularity of the language.</p>
<p>Today there are several BASIC compilers; most of them implement a
modernized version of Microsoft’s BASIC dialect, but unfortunately there
are several slight differences in the syntax and grammar. (This is in
contrast with C++ compilers like <code>g++</code> and
<code>clang</code>, which understand pretty much the same language.).
The most notable are the following:</p>
<ul>
<li><p>FreeBasic (<a
href="https://www.freebasic.net/">www.freebasic.net</a>): an open-source
implementation of the Microsoft BASIC dialect, with many enhancements.
It can emit C code that can be compiled by GCC: in this mode of
operation, it produces extremely fast executables.</p></li>
<li><p>QB64 (<a href="https://www.qb64.org/portal/">www.qb64.org</a>): a
modern clone of Microsoft QuickBASIC.</p></li>
<li><p>Xojo (<a href="https://www.xojo.com/">www.xojo.com</a>): a
commercial BASIC compiler.</p></li>
<li><p>PureBASIC (<a
href="https://www.purebasic.com/">www.purebasic.com</a>): another
commercial BASIC compiler.</p></li>
<li><p>Visual Studio.NET: this is a language by Microsoft which produces
managed executables fully equivalent to their C# counterparts. It is a
very nice language, which implements the same features as C# using a
BASIC syntax and is supported by the <code>dotnet</code> executable
discussed in the part about C#. It would have been a great choice for
this course, but unfortunately Microsoft has recently discontinued its
support, as the number of users has declined over the last years.
(Apparently, they all migrated to C#.)</p></li>
</ul>
<p>If you plan to use BASIC for this course, you are suggested to use
FreeBasic, and in any case you must avoid commercial compilers, as the
teacher must have a way to recompile your code to test it.</p>
<p>Here is an example showing how to implement a <code>Vec</code> data
structure similar to the one implemented in C++; the code assumes you
are using FreeBASIC:</p>
<div class="sourceCode" id="cb43"><pre
class="sourceCode monobasic"><code class="sourceCode monobasic"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>type Vec</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">as</span> <span class="dt">double</span> x, y, z</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">&#39; This converts a Vec into a printable string</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">declare</span> operator cast() <span class="kw">as</span> <span class="dt">string</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>end type</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>operator Vec.cast() <span class="kw">as</span> <span class="dt">string</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> <span class="st">&quot;&lt;&quot;</span> + str(x) + <span class="st">&quot;, &quot;</span> + str(y) + <span class="st">&quot;, &quot;</span> + str(z) + <span class="st">&quot;&gt;&quot;</span></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>end operator</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a><span class="co">&#39; Dot product</span></span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>operator*(<span class="kw">byval</span> v1 <span class="kw">as</span> Vec, <span class="kw">byval</span> v2 <span class="kw">as</span> Vec) <span class="kw">as</span> <span class="dt">double</span></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> v1.x * v2.x + v1.y * v2.y + v1.z * v2.z</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>end operator</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="co">&#39; Scalar-vector product</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>operator*(t <span class="kw">as</span> <span class="dt">double</span>, <span class="kw">byval</span> v <span class="kw">as</span> Vec) <span class="kw">as</span> Vec</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> type&lt;Vec&gt;(t * v.x, t * v.y, t * v.z)</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>end operator</span></code></pre></div>
<p>As this example shows, the syntax of the BASIC language is very
lightweight:</p>
<ul>
<li><p>there are no <code>;</code> at the end of each line, because each
line must contain one statement;</p></li>
<li><p>there is no need to use the curly braces <code>{}</code>, as
defining a new operator already starts its definition, which continues
up to the next <code>end</code>; each <code>end</code> is marked with a
keyword (e.g., <code>end type</code>, <code>end operator</code>) to
improve clarity.</p></li>
<li><p>BASIC is a case-insensitive language, so it is ok to write
<code>END OPERATOR</code>, <code>end operator</code> (like above), or
<code>End Operator</code> (as it is often the case in textbooks). This
is a good thing, as it prevents you from using <code>X</code> and
<code>x</code> to name two different variables, as it would be
possible—but discouraged!—in C++.</p></li>
</ul>
<p>Here is the implementation of the <code>ray</code> and
<code>sphere</code> types, as well as the code to check the intersection
between a ray and a sphere:</p>
<div class="sourceCode" id="cb44"><pre
class="sourceCode monobasic"><code class="sourceCode monobasic"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>type ray</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">as</span> Vec m_o</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">as</span> Vec m_d</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">as</span> <span class="dt">double</span> m_tmin</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">as</span> <span class="dt">double</span> m_tmax</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>end type</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>type sphere</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">as</span> Vec m_p</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">as</span> <span class="dt">double</span> m_r</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>end type</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="kw">function </span>intersect(<span class="kw">byval</span> s <span class="kw">as</span> sphere, <span class="kw">byval</span> r <span class="kw">as</span> ray) <span class="kw">as</span> <span class="dt">boolean</span></span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">dim</span> op <span class="kw">as</span> Vec = s.m_p - r.m_o</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">dim</span> dop <span class="kw">as</span> <span class="dt">double</span> = r.m_d * op</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">dim</span> d <span class="kw">as</span> <span class="dt">double</span> = dop * dop - op * op + s.m_r * s.m_r</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if </span>0.0 &gt; d <span class="kw">then</span> <span class="kw">return</span> <span class="kw">false</span></span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">dim</span> sqrtd <span class="kw">as</span> <span class="dt">double</span> = sqr(d)</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">dim</span> tmin <span class="kw">as</span> <span class="dt">double</span> = dop - sqrtd</span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>    <span class="kw">if </span>(r.m_tmin &lt; tmin) <span class="kw">and</span> (tmin &lt; r.m_tmax) <span class="kw">then</span> <span class="kw">return</span> <span class="kw">true</span></span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">dim</span> tmax <span class="kw">as</span> <span class="dt">double</span> = dop + sqrtd</span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">return</span> (r.m_tmin &lt; tmax) <span class="kw">and</span> (tmax &lt; r.m_tmax)</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a><span class="kw">end function</span></span></code></pre></div>
<p>In FreeBASIC, variables are declared using the keyword
<code>dim</code> (which originally stood for <code>dimension</code>,
because in the old Microsoft BASIC it was used primarily to initialize
arrays). Like C++ but unlike Pascal, variables can be defined everywhere
in the code.</p>
<p>FreeBASIC has several advantages over C++:</p>
<ul>
<li><p>Despite the fact that implements many advanced features like
classes, polymorphism, operator overloading, etc., it uses an extremely
clean syntax, with no <code>;</code>, <code>{}</code>, etc. It is indeed
refreshing to program in FreeBASIC after having been exposed to
C++!</p></li>
<li><p>The language is well documented. In particular, there is one page
that shows the correspondence between C++ constructs and FreeBASIC
constructs: <a
href="https://www.freebasic.net/wiki/TblComparisonC">www.freebasic.net/wiki/TblComparisonC</a>.</p></li>
<li><p>The language is quite safe, as every variable is automatically
initialized to zero. Not initializing variables is a very common bug in
C++, as the following example shows:</p>
<div class="sourceCode" id="cb45"><pre
class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> sum<span class="op">(</span><span class="at">const</span> <span class="bu">std::</span>vector<span class="op">&lt;</span><span class="dt">double</span><span class="op">&gt;</span> <span class="op">&amp;</span>list<span class="op">)</span> <span class="op">{</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> sum<span class="op">;</span>  <span class="co">// Oh no, I forgot to initialize this variable!</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(</span><span class="kw">auto</span> elem <span class="op">:</span> list<span class="op">)</span> <span class="op">{</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>        sum <span class="op">+=</span> list<span class="op">;</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sum<span class="op">;</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>These bugs are impossible in FreeBASIC.</p></li>
<li><p>The compiler is extremely fast.</p></li>
<li><p>The standard library provides the possibility to open a window
and directly draw in it, using the commands <code>screen</code>,
<code>pset</code>, etc. This can be used to provide a real-time preview
of the images rendered by the code that you will develop for this
course, which is extremely handy. The following is an example:</p>
<p><img src="pd-images/freebasic-rendering.png"
style="width:67.0%" /></p></li>
</ul>
<p>FreeBASIC has a few disadvantages too:</p>
<ul>
<li><p>There is no real IDE for the language: you are forced to use a
plain editor. (I use Emacs and <a
href="https://github.com/z80lives/freebasic-mode"><code>freebasic-mode</code></a>;
probably there are other good alternative available on the web.) This
means that you’ll lack more advanced features like variable renaming,
code browsing, refactoring tools, etc.</p></li>
<li><p>There are only a few online resources to learn the language.
However, as said above, the documentation of the FreeBASIC compiler is
quite good (<a
href="https://www.freebasic.net/wiki/DocToc">www.freebasic.net/wiki/DocToc</a>).</p></li>
<li><p>It is not easy to download and install new libraries, as the
language lacks a package manager. (This shortcoming is shared with
C++.)</p></li>
<li><p>Mac OS X is not supported officially, although <a
href="https://www.freebasic.net/forum/viewtopic.php?t=32191">people
report</a> that it can be possible to make it run on Apple
hardware</p></li>
</ul>
<h1 id="julia">Julia</h1>
<p>Julia is a modern language for scientific computing. It is heavily
inspired by the Scheme language, a LISP dialect that introduced several
interesting programming paradigms like hygienic macros and functional
patterns.</p>
<p>Julia’s main purpose is to provide a highly performant language for
scientific applications, and as a consequence has stellar support for
mathematical operations. Although the language is very easy to learn, it
is not straightforward to develop <em>fast</em> code, as the execution
model is significantly different from any other language listed in this
document.</p>
<p>To see how Julia helps in writing scientific code, here is the
implementation of the vector data structure:</p>
<div class="sourceCode" id="cb46"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">LinearAlgebra</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="im">using</span> <span class="bu">StaticArrays</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> Vec <span class="op">=</span> SVector{<span class="fl">3</span>,<span class="dt">Float64</span>}</span></code></pre></div>
<p>There is no need to define any operator for <code>Vec</code> class,
as Julia has native support for vector operations: addition, dot product
and scalar-product multiplication are already available.</p>
<p>The following code implements the <code>Ray</code> and
<code>Sphere</code> data structures, as well as the
<code>intersect</code> method:</p>
<div class="sourceCode" id="cb47"><pre
class="sourceCode julia"><code class="sourceCode julia"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Ray</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>    o<span class="op">::</span><span class="dt">Vec</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    d<span class="op">::</span><span class="dt">Vec</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    tmin<span class="op">::</span><span class="dt">Float64</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    tmax<span class="op">::</span><span class="dt">Float64</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># We provide three constructors using overloading</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Ray</span>(o, d, tmin, tmax) <span class="op">=</span> <span class="fu">new</span>(o, d, tmin, tmax)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Ray</span>(o, d, tmin) <span class="op">=</span> <span class="fu">new</span>(o, d, tmin, DEFAULT_TMAX)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Ray</span>(o, d) <span class="op">=</span> <span class="fu">new</span>(o, d, DEFAULT_TMIN, DEFAULT_TMAX)</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Sphere</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>    r<span class="op">::</span><span class="dt">Float64</span></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>    p<span class="op">::</span><span class="dt">Vec</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">intersect</span>(s<span class="op">::</span><span class="dt">Sphere</span>, ray<span class="op">::</span><span class="dt">Ray</span>)</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>    op <span class="op">=</span> s.p <span class="op">-</span> ray.o</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>    dop <span class="op">=</span> ray.d • op</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> dop<span class="op">^</span><span class="fl">2</span> <span class="op">-</span> op • op <span class="op">+</span> s.r<span class="op">^</span><span class="fl">2</span></span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a>    <span class="fl">0.0</span> <span class="op">&gt;</span> d <span class="op">&amp;&amp;</span> <span class="cf">return</span> <span class="cn">false</span></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>    sqrtD <span class="op">=</span> √d</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>    tmin <span class="op">=</span> dop <span class="op">-</span> sqrtD</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The «Julia way» to write &quot;if … then return true&quot;</span></span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>    (ray.tmin <span class="op">&lt;</span> tmin <span class="op">&lt;</span> ray.tmax) <span class="op">&amp;&amp;</span> <span class="cf">return</span> <span class="cn">true</span></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a>    tmax <span class="op">=</span> dop <span class="op">+</span> sqrtD</span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a>    ray.tmin <span class="op">&lt;</span> tmax <span class="op">&lt;</span> ray.tmax</span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>Even if you do not understand the mathematics used in the
<code>intersect</code> method, the sequence of mathematical operations
should be clear. The dot operator <code>•</code> is provided by the
<code>LinearAlgebra</code> package, which was loaded before defining the
<code>Vec</code> class. A few other niceties of the language are the
following:</p>
<ul>
<li><p>There is no need to close a statement with <code>;</code> because
they end at the end of a line;</p></li>
<li><p>There are no curly braces <code>{}</code>, you just write
<code>end</code> when appropriate;</p></li>
<li><p>Julia implements the ternary operator
<code>a &lt; x &lt; b</code>, which corresponds to the longer form
<code>(a &lt; x) &amp;&amp; (x &lt; b)</code> in C++;</p></li>
<li><p>Several mathematical operators can be used as functions or
mathematical operators: for instance, you can either write
<code>√d</code> or <code>sqrt(d)</code>, and <code>ray.d • op</code> or
<code>dot(ray.d, op)</code>;</p></li>
<li><p>There is no need to write <code>return</code> on the last
statement of a function.</p></li>
</ul>
<p>The most important advantages of Julia are the following:</p>
<ul>
<li><p>It matches the same speed as C++;</p></li>
<li><p>Julia’s syntax is clear and nice to read, much similar to
FreeBASIC;</p></li>
<li><p>Mathematical codes like the ones to be developed for this course
are easy to write in Julia, thanks to its friendly mathematical
notation;</p></li>
<li><p>It has a rock-solid package manager, which can be used to easily
install packages from the Internet.</p></li>
</ul>
<p>However, Julia has a few disadvantages:</p>
<ul>
<li><p>It must be used as an interpreter: although possible, it is not
trivial to produce a standalone executable. This will require students
using Julia for this course to quickly learn how to adapt the way the
code is described during the classes to the way Julia works: Julia code
is usually not executed from the command line as it is the case in C++.
Past students often found counterintuitive to do this.</p></li>
<li><p>It uses <em>multiple dispatch</em> instead of traditional OOP
constructs. Although in my opinion multiple dispatch is superior to OOP,
developing Julia code requires a change in mindset if one comes from OOP
languages like C++.</p></li>
<li><p>Sometimes it is not immediate to understand why some Julia code
is slow; one needs to fully understand Julia’s execution model to take
full advantage of its capabilities.</p></li>
</ul>
<p>Apart from the <a href="https://docs.julialang.org/en/v1/">official
documentation</a>, a <strong>great</strong> book to learn Julia is <a
href="https://www.packtpub.com/product/hands-on-design-patterns-and-best-practices-with-julia/9781838648817">Hands-On
Design Patterns and Best Practices with Julia</a>, by Tom Kwong. It
describes with many practical examples how to properly use Julia, and
what are the best strategies to optimize code for maximum performance.
Manning is going to publish a new book about Julia, <a
href="https://www.manning.com/books/julia-as-a-second-language">Julia as
a second language</a> by Erik Engheim, which is another great
introduction to the language; although it is not completed yet, you can
already buy a draft copy for a discounted price and receive the full
copy once it will be finished. (Disclaimer: I’m the technical reviewer
of this book.)</p>
<p>There is also some good material on YouTube: <a
href="https://www.youtube.com/watch?v=4igzy3bGVkQ">A Gentle Introduction
to Julia</a> (syntax) and <a
href="https://www.youtube.com/watch?v=-lJK92bEKow">Getting Started with
Julia (for Experienced Programmers)</a> (development environment) are
two examples.</p>
<p>In the past, the satisfaction of students who picked Julia was quite
high, but some of them lamented that it required substantial effort to
«un-learn» how to do some tasks in C++ and to understand the different
approach required by Julia.</p>
<h1 id="kotlin">Kotlin</h1>
<p>Kotlin is a relatively new language, as its first version was
released in 2011. It is a <em>managed</em> language like C#, but it is
based on the Java Virtual Machine; so, many of the things discussed for
C# apply to Kotlin as well.</p>
<p>Kotlin is being used more and more since Google added full support
for Kotlin<a href="#fn9" class="footnote-ref" id="fnref9"
role="doc-noteref"><sup>9</sup></a> in the Android operating system
(previously only Java was fully supported, with partial support for C,
C++, and Go). If you are interested in mobile programming, it might be
worth picking this language.</p>
<p>Kotlin was developed by JetBrains, a company that offers several
advanced IDEs like CLion (C++ and Rust), PyCharm (Python), IntelliJ IDEA
(Java/Kotlin), etc. For this reason, JetBrains provides an IDE with
stellar support for Kotlin through IntelliJ IDEA. If you pick Kotlin,
you should install IDEA and do not look for anything else.</p>
<p>Here is a possible implementation for the <code>Vec</code> class,
which implements a 3D vector:</p>
<div class="sourceCode" id="cb48"><pre
class="sourceCode kotlin"><code class="sourceCode kotlin"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="kw">class</span> Vec<span class="op">(</span><span class="kw">val</span> <span class="va">x</span><span class="op">:</span> <span class="dt">Double</span><span class="op">,</span> <span class="kw">val</span> <span class="va">y</span><span class="op">:</span> <span class="dt">Double</span><span class="op">,</span> <span class="kw">val</span> <span class="va">z</span><span class="op">:</span> <span class="dt">Double</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">override</span> <span class="kw">fun</span> <span class="fu">toString</span><span class="op">():</span> <span class="dt">String</span> <span class="op">{</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="st">&quot;&lt;</span><span class="ss">$x</span><span class="st">, </span><span class="ss">$y</span><span class="st">, </span><span class="ss">$z</span><span class="st">&gt;&quot;</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">operator</span> <span class="kw">fun</span> <span class="fu">times</span><span class="op">(</span><span class="va">other</span><span class="op">:</span> <span class="dt">Vec</span><span class="op">):</span> <span class="dt">Double</span> <span class="op">{</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> x <span class="op">*</span> other<span class="op">.</span>x <span class="op">+</span> y <span class="op">*</span> other<span class="op">.</span>y <span class="op">+</span> z <span class="op">*</span> other<span class="op">.</span>z</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">operator</span> <span class="kw">fun</span> <span class="fu">times</span><span class="op">(</span><span class="va">t</span><span class="op">:</span> <span class="dt">Double</span><span class="op">):</span> <span class="dt">Vec</span> <span class="op">{</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> Vec<span class="op">(</span>t <span class="op">*</span> x<span class="op">,</span> t <span class="op">*</span> y<span class="op">,</span> t <span class="op">*</span> z<span class="op">)</span></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Kotlin’s syntax is clearly inspired by C++, but it avoids using
<code>;</code>. However, unlike C++, the variable members are listed
<em>before</em> the curly braces: similarly to Pascal but unlike C++,
types are specified after parameter names.</p>
<p>Here is the implementation of the <code>Ray</code> and
<code>Sphere</code> classes:</p>
<div class="sourceCode" id="cb49"><pre
class="sourceCode kotlin"><code class="sourceCode kotlin"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">kotlin</span><span class="op">.</span><span class="im">math</span><span class="op">.</span><span class="im">sqrt</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="kw">class</span> Ray<span class="op">(</span><span class="kw">val</span> <span class="va">m_o</span><span class="op">:</span> <span class="dt">Vec</span><span class="op">,</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>               <span class="kw">val</span> <span class="va">m_d</span><span class="op">:</span> <span class="dt">Vec</span><span class="op">,</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>               <span class="kw">val</span> <span class="va">m_tmin</span><span class="op">:</span> <span class="dt">Double</span> <span class="op">=</span> <span class="fl">1e-10</span><span class="op">,</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>               <span class="kw">val</span> <span class="va">m_tmax</span><span class="op">:</span> <span class="dt">Double</span> <span class="op">=</span> <span class="fl">1e+10</span><span class="op">)</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="kw">class</span> Sphere<span class="op">(</span><span class="kw">val</span> <span class="va">m_r</span><span class="op">:</span> <span class="dt">Double</span><span class="op">,</span> <span class="kw">val</span> <span class="va">m_p</span><span class="op">:</span> <span class="dt">Vec</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fun</span> <span class="fu">intersect</span><span class="op">(</span><span class="va">ray</span><span class="op">:</span> <span class="dt">Ray</span><span class="op">)</span> <span class="op">:</span> <span class="dt">Boolean</span> <span class="op">{</span></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">val</span> <span class="va">op</span> <span class="op">=</span> m_p <span class="op">-</span> ray<span class="op">.</span>m_o</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>        <span class="kw">val</span> <span class="va">dop</span> <span class="op">=</span> ray<span class="op">.</span>m_d <span class="op">*</span> op</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">val</span> <span class="va">D</span> <span class="op">=</span> dop <span class="op">*</span> dop <span class="op">-</span> op <span class="op">*</span> op <span class="op">+</span> m_r <span class="op">*</span> m_r</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span><span class="dv">0</span> <span class="op">&gt;</span> D<span class="op">)</span> <span class="op">{</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">false</span></span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>        <span class="kw">val</span> <span class="va">sqrtD</span> <span class="op">=</span> sqrt<span class="op">(</span>D<span class="op">)</span></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>        <span class="kw">val</span> <span class="va">tmin</span> <span class="op">=</span> dop <span class="op">-</span> sqrtD</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>ray<span class="op">.</span>m_tmin <span class="op">&lt;</span> tmin <span class="op">&amp;&amp;</span> tmin <span class="op">&lt;</span> ray<span class="op">.</span>m_tmax<span class="op">)</span> <span class="op">{</span></span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>            <span class="kw">return</span> <span class="kw">true</span></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>        <span class="kw">val</span> <span class="va">tmax</span> <span class="op">=</span> dop <span class="op">+</span> sqrtD</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>        <span class="kw">return</span> <span class="op">(</span>ray<span class="op">.</span>m_tmin <span class="op">&lt;</span> tmax <span class="op">&amp;&amp;</span> tmax <span class="op">&lt;</span> ray<span class="op">.</span>m_tmax<span class="op">)</span></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>A few advantages of Kotlin are the following:</p>
<ul>
<li><p>If you are interested in learning a modern language that can be
used to develop mobile applications for Android devices, Kotlin is
probably the best option.</p></li>
<li><p>Kotlin is pedagogically useful, as it implements a very neat way
to implement<a href="#fn10" class="footnote-ref" id="fnref10"
role="doc-noteref"><sup>10</sup></a> <em>null safety</em> through
nullable values. These are used when you request the value for a
variable from some source which might be unavailable or erroneous (e.g.,
a missing file, or a badly typed user input.)</p></li>
<li><p>There are several libraries available to Kotlin programs, as you
can easily import and use Java libraries.</p></li>
</ul>
<p>Disadvantages of Kotlin:</p>
<ul>
<li><p>Although the syntax looks clean, it is not as straightforward as
C# or FreeBASIC.</p></li>
<li><p>You will probably need to learn a new build system, as Makefiles
do not work well with the Java Virtual Machine. (However, if you use
IntelliJ IDEA you can manage this task from within a graphical user
interface.)</p></li>
<li><p>You are forced to use the Java Virtual Machine (JVM); this might
be considered an advantage or a disadvantage, depending on the case. On
one hand, the JVM makes impossible segmentation faults (a virtue of
managed languages!). However, you might need to tune the Java Virtual
Machine to obtain good performance. (This is partly true for C# as well,
but the problem seems to be more relevant for the JVM.)</p></li>
<li><p>It happens quite often that Kotlin’s documentation refers to
Java, and thus you are somewhat expected to get acquainted with this
language too. This is due to the fact that Kotlin is heavily based on
Java, much like C++ is based on C.</p></li>
<li><p>The students that have used Kotlin in the last year sometimes
felt that tasks that other students found hard to implement were solved
automatically and almost «magically» by the IDE, depriving them of the
opportunity to better learn what was happening behind the
scenes.</p></li>
</ul>
<p>A few good resources to learn Kotlin:</p>
<ul>
<li><p>The YouTube video <a
href="https://www.youtube.com/watch?v=F9UC9DY-vIU">Kotlin Course -
Tutorial for Beginners</a> is probably the best video around that
teaches (1) how to program in Kotlin and (2) how to use IntelliJ IDEA to
write code in Kotlin.</p></li>
<li><p>A good book is <a
href="https://www.manning.com/books/the-joy-of-kotlin"><em>The Joy of
Kotlin</em></a>, by Pierre-Yves Saumont (2019, Manning). Another book by
Manning is <a
href="https://www.manning.com/books/kotlin-in-action"><em>Kotlin in
action</em></a>, by Dmitry Jemerov and Svetlana Isakova (2017, Manning),
but this one assumes you already know Java.</p></li>
</ul>
<h1 id="rust">Rust</h1>
<p>The last language described in this document is Rust (<a
href="https://www.rust-lang.org/">www.rust-lang.org</a>), which is
probably the most complex language you can pick for this course.</p>
<p>The first stable release of the language was published in 2010,
although Rust was already being used in several professional projects.
The development team was led by Graydon Hoare (Mozilla Foundation).</p>
<p>Rust is a language that looks similar to C++ (curly braces
<code>{}</code> everywhere!), yet it introduces a few new fundamental
concepts:</p>
<ul>
<li>Data ownership;</li>
<li>Borrowing model;</li>
<li>Lifetime tracking.</li>
</ul>
<p>The concept of «data ownership» is implemented in C++ as well through
the classes <code>std::unique_ptr</code> and
<code>std::shared_ptr</code>, but Rust implements it in a pervasive way,
as it is deeply buried in the fundamentals of the language, while in C++
it is a matter of two classes in the standard library.</p>
<p>Grasping data ownership, borrowing rules and lifetimes can be
daunting; in fact, they are probably among the biggest difficulties in
learning the language. There are several good resources online that
teach these concepts, but unfortunately you can’t postpone learning
them, as all of them are fundamental to write any non-trivial codes. On
the other side, the usage of Rust is more and more widespread, and it
seems that several people in the field of physics are interested in
learning it. Moreover, it is a formidable pedagogical tool to learn how
values are represented in memory: learning Rust makes you a better
programmer, no matter if you later abandon it and move to other
languages!</p>
<p>Because of its difficulty, I strongly suggest that only people that
have already written some non-trivial code in Rust pick it for this
course. It would be optimal if <em>at least three students</em> pick
Rust, so that if one of them gets frustrated and picks some other
language, the other two can keep using it.</p>
<p>The code we implemented so far is not a good example of the
difficulty of the language, as the <code>Vec3</code> type is a <em>value
type</em> (allocated on the stack and not on the heap). The code that
implements the data type <code>Vec3</code> thus looks deceivingly
trivial:</p>
<div class="sourceCode" id="cb50"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="kw">use</span> <span class="pp">std::</span>ops<span class="op">;</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co">// The ability to print Vec3 variables is automatically enabled</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co">// by &quot;Debug&quot;</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span>derive<span class="at">(</span><span class="bu">Copy</span><span class="op">,</span> <span class="bu">Clone</span><span class="op">,</span> <span class="bu">Debug</span><span class="at">)]</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Vec3 <span class="op">{</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>    x<span class="op">:</span> <span class="dt">f64</span><span class="op">,</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    y<span class="op">:</span> <span class="dt">f64</span><span class="op">,</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    z<span class="op">:</span> <span class="dt">f64</span><span class="op">,</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co">// Dot product</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="kw">impl</span> <span class="pp">ops::</span><span class="bu">Mul</span><span class="op">&lt;</span>Vec3<span class="op">&gt;</span> <span class="cf">for</span> Vec3 <span class="op">{</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">type</span> Output <span class="op">=</span> <span class="dt">f64</span><span class="op">;</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> mul(<span class="kw">self</span><span class="op">,</span> other<span class="op">:</span> Vec3) <span class="op">-&gt;</span> <span class="dt">f64</span> <span class="op">{</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>        <span class="kw">self</span><span class="op">.</span>x <span class="op">*</span> other<span class="op">.</span>x <span class="op">+</span> <span class="kw">self</span><span class="op">.</span>y <span class="op">*</span> other<span class="op">.</span>y <span class="op">+</span> <span class="kw">self</span><span class="op">.</span>z <span class="op">*</span> other<span class="op">.</span>z</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a><span class="co">// Scalar-vector product</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a><span class="kw">impl</span> <span class="pp">ops::</span><span class="bu">Mul</span><span class="op">&lt;</span><span class="dt">f64</span><span class="op">&gt;</span> <span class="cf">for</span> Vec3 <span class="op">{</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>    <span class="kw">type</span> Output <span class="op">=</span> Vec3<span class="op">;</span></span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">fn</span> mul(<span class="kw">self</span><span class="op">:</span> Vec3<span class="op">,</span> other<span class="op">:</span> <span class="dt">f64</span>) <span class="op">-&gt;</span> Vec3 <span class="op">{</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>        Vec3 <span class="op">{</span></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>            x<span class="op">:</span> other <span class="op">*</span> <span class="kw">self</span><span class="op">.</span>x<span class="op">,</span></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>            y<span class="op">:</span> other <span class="op">*</span> <span class="kw">self</span><span class="op">.</span>y<span class="op">,</span></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>            z<span class="op">:</span> other <span class="op">*</span> <span class="kw">self</span><span class="op">.</span>z<span class="op">,</span></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Here is the implementation of the <code>Ray</code> and
<code>Sphere</code> data types, as well as the ray/sphere intersection
code. Again, the complexity of the Rust memory model does not appear
here because we are still using value types:</p>
<div class="sourceCode" id="cb51"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span>derive<span class="at">(</span><span class="bu">Copy</span><span class="op">,</span> <span class="bu">Clone</span><span class="op">,</span> <span class="bu">Debug</span><span class="at">)]</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Ray <span class="op">{</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    m_o<span class="op">:</span> Vec3<span class="op">,</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    m_d<span class="op">:</span> Vec3<span class="op">,</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    m_tmin<span class="op">:</span> <span class="dt">f64</span><span class="op">,</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    m_tmax<span class="op">:</span> <span class="dt">f64</span><span class="op">,</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="at">#[</span>derive<span class="at">(</span><span class="bu">Copy</span><span class="op">,</span> <span class="bu">Clone</span><span class="op">,</span> <span class="bu">Debug</span><span class="at">)]</span></span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> Sphere <span class="op">{</span></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>    m_r<span class="op">:</span> <span class="dt">f64</span><span class="op">,</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>    m_p<span class="op">:</span> Vec3<span class="op">,</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> intersect(sphere<span class="op">:</span> Sphere<span class="op">,</span> ray<span class="op">:</span> Ray) <span class="op">-&gt;</span> <span class="dt">bool</span> <span class="op">{</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> op <span class="op">=</span> sphere<span class="op">.</span>m_p <span class="op">-</span> ray<span class="op">.</span>m_o<span class="op">;</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> dop <span class="op">=</span> ray<span class="op">.</span>m_d <span class="op">*</span> op<span class="op">;</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> d <span class="op">=</span> dop <span class="op">*</span> dop <span class="op">-</span> op <span class="op">*</span> op <span class="op">+</span> sphere<span class="op">.</span>m_r <span class="op">*</span> sphere<span class="op">.</span>m_r<span class="op">;</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="dv">0.0</span> <span class="op">&gt;</span> d <span class="op">{</span></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="cn">false</span><span class="op">;</span></span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> sqrtd <span class="op">=</span> d<span class="op">.</span>sqrt()<span class="op">;</span></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> tmin <span class="op">=</span> dop <span class="op">-</span> sqrtd<span class="op">;</span></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (ray<span class="op">.</span>m_tmin <span class="op">&lt;</span> tmin) <span class="op">&amp;&amp;</span> (tmin <span class="op">&lt;</span> ray<span class="op">.</span>m_tmax) <span class="op">{</span></span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="cn">true</span><span class="op">;</span></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> tmax <span class="op">=</span> dop <span class="op">+</span> sqrtd<span class="op">;</span></span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a>    (ray<span class="op">.</span>m_tmin <span class="op">&lt;</span> tmax) <span class="op">&amp;&amp;</span> (tmax <span class="op">&lt;</span> ray<span class="op">.</span>m_tmax)<span class="op">;</span></span>
<span id="cb51-33"><a href="#cb51-33" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The code above does not show the mechanism of borrowing, nor data
ownership or lifetime, mainly because of the <code>Copy</code> and
<code>Clone</code> specifications, which elegantly avoid the issue in
this particular problem. However, this is <strong>not going to be
true</strong> for many other data structures that will be used in the
course, so this example is a oversimplification.</p>
<p>Here is a list of advantages for Rust:</p>
<ul>
<li><p>It is pedagogically important to understand the concept of «data
ownership», «borrowing», and «lifetimes». No other language listed in
this document forces students to learn them <em>well</em>.</p></li>
<li><p>IDE support for Rust is excellent: <a
href="https://www.jetbrains.com/clion/">JetBrains CLion</a> with the
Rust plugin is perfect (and JetBrains is working on a dedicated IDE, <a
href="https://www.jetbrains.com/rust/">RustRover</a>, which however has
not been released yet), and you should look nowhere else. <a
href="https://code.visualstudio.com/">Visual Studio Code</a> is quite
good if you install a plugin that support the Language Server Protocol
(LSP). However, even with the best plugin, Visual Studio Code is still
not as good as CLion.</p></li>
<li><p>Despite its young age, there are several online resources to
learn the language. (This is probably related to the fact that it has
been awarded «best language of the year» several years in a row by <a
href="https://insights.stackoverflow.com/survey/2020#most-loved-dreaded-and-wanted">the
StackOverflow site</a>.)</p></li>
<li><p>Programs written in Rust are very fast, usually on par with
C++.</p></li>
<li><p>It is trivial to handle projects written in Rust using the
<code>cargo</code> package manager, as there is no need to write a
<code>Makefile</code> to trigger compilations. The following command
creates a new folder <code>myproj</code> and initializes a «Hello
world!» program in it:</p>
<pre><code>$ cargo new myproj</code></pre>
<p>To compile and run the program, run the following command within the
<code>myproj</code> directory:</p>
<pre><code>$ cargo run</code></pre>
<p>If you use CLion, things are even simpler, as pressing
<code>Shift+F10</code> automatically calls <code>cargo</code> and
executes the program in a terminal window.</p></li>
<li><p>Like <code>dotnet</code> for C#, <code>cargo</code> has the
ability to download libraries and package from the web and install them
automatically.</p></li>
</ul>
<p>A few disadvantages of Rust are the following:</p>
<ul>
<li><p>As I repeatedly stated above, Rust is a hard language to
learn!</p></li>
<li><p>Its support for floating-point numbers favours correctness over
easiness-of-use, but in some cases this «correctness» is more
theoretical than real. This means that implementing a few algorithms
required in the course will require more pain than for other languages,
but the resulting code will not necessarily be more robust.</p></li>
<li><p>Handling errors (an important topic in this course) is really
hard!</p></li>
<li><p>The compiler can be <strong>extremely slow</strong> in compiling
programs.</p></li>
</ul>
<p>A few good resources to learn Rust:</p>
<ul>
<li><p>Two excellent books are <a
href="https://doc.rust-lang.org/book/"><em>The Rust programming
language</em></a> by Steve Klabnik and Carol Nichols (No starch press,
2019), and <a
href="https://www.manning.com/books/rust-in-action"><em>Rust in
action</em></a> by Timothy S. McNamara (Manning, 2021).</p></li>
<li><p><a
href="https://www.youtube.com/channel/UCpeX4D-ArTrsqvhLapAHprQ">Ryan
Levick’s YouTube Channel</a> has some very good videos about Rust. Alas,
the editor used in the videos is Visual Studio Code and not
CLion!</p></li>
</ul>
<aside id="footnotes" class="footnotes footnotes-end-of-document"
role="doc-endnotes">
<hr />
<ol>
<li id="fn1"><p>A good choice is <a
href="https://fmt.dev/latest/index.html"><code>fmt</code></a>, which was
included in the C++20 standard.<a href="#fnref1" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>For example, if one changes an header file but fails to
list the proper dependencies in the <code>Makefile</code>, some
<code>.cpp</code> files depending on that header might fail to be
recompiled in a <code>.o</code> file, leading to potential disasters.<a
href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Yes, you can use ROOT in Nim if you want! You just need
to force the compiler to output C++ code instead of C and use the
<code>{.importcpp.}</code> pragma to create your own bindings.<a
href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>Cairo is a C library to create graphics and save it in
PNG, PDF, or SVG files. Nim bindings can be installed through the
command <code>nimble install cairo</code>.<a href="#fnref4"
class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>For example, if an <code>else</code> branch of an
<code>if</code> statement is executed very often, the CLR can rewrite
the <code>if</code> statement to swap the code below <code>if</code>
with the code below <code>else</code>, as this might make the code
faster.<a href="#fnref5" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>It is interesting to note that one of the lead
developers of the Turbo Pascal compiler was Anders Hejlsberg, the
creator of C#.<a href="#fnref6" class="footnote-back"
role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>If you are curious, you can test how Mac OS looked like
in your browser by going to <a href="https://macos9.app/"
class="uri">https://macos9.app/</a>.<a href="#fnref7"
class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>If you are curious, you can run a copy of QBasic within
your web browser, thanks to the Internet Archive: <a
href="https://archive.org/details/msdos_qbasic_megapack">archive.org/details/msdos_qbasic_megapack</a>.<a
href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p>In Italy, one of the most famous apps available on the
Google Store is the <em>Immuni</em> app. It has been written in Kotlin,
and the source code is available online: <a
href="https://github.com/immuni-app/immuni-app-android">github.com/immuni-app/immuni-app-android</a><a
href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn10"><p>The term <em>null safety</em> refers to the ability of
a language or a program to properly handle missing values.<a
href="#fnref10" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</aside>
</body>
</html>
