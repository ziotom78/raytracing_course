<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Maurizio Tomasi maurizio.tomasi@unimi.it">
  <title>Lezione 3</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//dist/reset.css">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="https://unpkg.com/reveal.js@^4//dist/theme/white.css" id="theme">
  <link rel="stylesheet" href="./css/custom.css"/>
  <link rel="stylesheet" href="./css/asciinema-player.css"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
   var mathElements = document.getElementsByClassName("math");
   var macros = [];
   for (var i = 0; i < mathElements.length; i++) {
    var texText = mathElements[i].firstChild;
    if (mathElements[i].tagName == "SPAN") {
     katex.render(texText.data, mathElements[i], {
      displayMode: mathElements[i].classList.contains('display'),
      throwOnError: false,
      macros: macros,
      fleqn: false
     });
  }}});
  </script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" />
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">Lezione 3</h1>
  <p class="subtitle">Calcolo numerico per la generazione di immagini fotorealistiche</p>
  <p class="author">Maurizio Tomasi <a href="mailto:maurizio.tomasi@unimi.it" class="email">maurizio.tomasi@unimi.it</a></p>
</section>

<section id="file-binari-e-di-testo" class="slide level1">
<h1>File binari e di testo</h1>
</section>
<section id="file-binari" class="slide level1">
<h1>File binari</h1>
<ul>
<li><p>I file binari sono il tipo pi√π semplice: consistono di una sequenza di byte (ossia, 8 bit scritti in sequenza).</p></li>
<li><p>Ogni byte pu√≤ contenere un valore intero nell‚Äôintervallo 0‚Äì255</p></li>
<li><p>Per stampare il contenuto di un file binario potete usare il comando <code>xxd</code> (sotto Ubuntu, installatelo con <code>sudo apt install xxd</code>):</p>
<pre class="text"><code>$ xxd file.bin</code></pre>
<p>(Su altri sistemi operativi potreste avere <code>hexdump</code> anzich√© <code>xxd</code>).</p></li>
<li><p>Salvare dati in un file binario vuol dire scrivere una sequenza di numeri binari sul disco fisso, memorizzati come byte.</p></li>
</ul>
</section>
<section class="slide level1">

<p><asciinema-player src="./cast/binary-files-73x19.cast" cols="73" rows="19" font-size="medium"></asciinema-player></p>
</section>
<section id="da-binario-a-decimale" class="slide level1">
<h1>Da binario a decimale</h1>
<ul>
<li><p>Per ragionare sui valori dei byte si usa la numerazione binaria, che ovviamente usa come base il numero 2:</p>
<pre><code>0  ‚Üí 0
1  ‚Üí 1
2  ‚Üí 10
3  ‚Üí 11
4  ‚Üí 100
‚Ä¶</code></pre></li>
<li><p>Per un numero <code>dcba</code> espresso in una base <span class="math inline">B</span>, il suo valore √®</p>
<p><span class="math display">
\text{value} = a \times B^0 + b \times B^1 + c \times B^2 + d \times B^3.
</span></p>
<p>Quindi il valore binario <code>100</code> corrisponde a <span class="math inline">0 \times 2^0 + 0 \times 2^1 + 1\times 2^2 = 4.</span></p></li>
</ul>
</section>
<section id="notazione-esadecimale" class="slide level1">
<h1>Notazione esadecimale</h1>
<ul>
<li><p>La notazione binaria √® per√≤ scomoda, perch√© i numeri richiedono rapidamente molte cifre (8 cifre per un byte!).</p></li>
<li><p>In alternativa alla notazione binaria si usa molto la notazione esadecimale (16), che usa le cifre</p>
<pre><code>0 1 2 3 4 5 6 7 8 9 A B C D E F</code></pre></li>
<li><p>La notazione esadecimale richiede 4 bit per cifra, perch√© <span class="math inline">2^4 = 16</span>. Siccome un byte √® composto da 8 bit, il valore di un byte √® sempre codificabile usando solo due cifre esadecimali (<code>0xFF = 255</code>).</p></li>
<li><p>In C/C++/D/Nim/Rust/Julia/C#/Kotlin, i numeri esadecimali si scrivono con <code>0x</code>, ad es. <code>0x1F67 = 8039</code> (in alcuni linguaggi <code>0b</code> introduce un numero binario).</p></li>
</ul>
</section>
<section id="ordine-dei-bit-in-un-byte" class="slide level1">
<h1>Ordine dei bit in un byte</h1>
<ul>
<li><p>C‚Äô√® sempre un‚Äôambiguit√† di fondo nel raggruppamento dei bit in byte, e sta nel loro ordine.</p></li>
<li><p>Se un byte √® formato dalla sequenza di bit <code>0011¬†0101</code>, esistono due modi per interpretarlo:</p>
<p><span class="math display">
\begin{aligned}
2^0 + 2^2 + 2^4 + 2^5 &amp;= 53,\\
2^2 + 2^3 + 2^5 + 2^7 &amp;= 172.
\end{aligned}
</span></p></li>
</ul>
</section>
<section id="endianness-dei-bit" class="slide level1">
<h1>¬´Endianness¬ª dei bit</h1>
<ul>
<li><p>L‚Äôordine dei bit in un byte √® detto in gergo <em>bit-endianness</em>, termine tratto dai <em>Viaggi di Gulliver</em> (1726), di J. Swift:</p>
<ol type="1">
<li>La codifica <em>big-endian</em> parte dalla potenza <em>maggiore</em> (¬´big¬ª);</li>
<li>La codifica <em>little-endian</em> parte dalla potenza <em>minore</em> (¬´little¬ª).</li>
</ol></li>
<li><p>Le CPU Intel e AMD oggi usate nei personal computer usano tutte la codifica <em>little-endian</em>. La codifica <em>big-endian</em> √® invece lo standard per le trasmissioni via rete (ed oggi √® ancora impiegata in alcune CPU ARM).</p></li>
<li><p>Fortunatamente, la <em>bit endianness</em> non sar√† qualcosa di cui dovremo preoccuparci nel nostro codice, ma dovremo invece affrontare la <em>byte endianness</em>!</p></li>
</ul>
</section>
<section id="usare-pi√π-di-8-bit" class="slide level1">
<h1>Usare pi√π di 8 bit</h1>
<ul>
<li><p>Un numero a 8 bit pu√≤ assumere valori da 0 a 255</p></li>
<li><p>√à un intervallo molto ridotto! Ma si possono combinare insieme pi√π bytes</p></li>
<li><p>In C++ esistono i tipi <code>int16_t</code> (16¬†bit ‚Üí 2¬†byte), <code>int32_t</code> (32¬†bit ‚Üí 4¬†byte), <code>int64_t</code> (64¬†bit ‚Üí 8¬†byte)</p>
<center>
<p><img data-src="media/bytes-and-data-types.svg" height="280" /></p>
</center></li>
</ul>
</section>
<section id="endianness-dei-byte" class="slide level1">
<h1>Endianness dei byte</h1>
<ul>
<li><p>Se si combinano insieme pi√π byte, c‚Äô√® di nuovo il problema della <em>endianness</em>!</p></li>
<li><p>Ad esempio, il numero esadecimale a 16 bit 1F3D (2 byte) si codifica con la coppia di byte <code>1F 3D</code> (<em>big endian</em>) oppure <code>3D 1F</code> (<em>little endian</em>)?</p></li>
<li><p>Si parla anche in questo caso di codifica di byte <em>big endian</em> o <em>little endian</em></p></li>
<li><p>A differenza della <em>bit endianness</em>, dovremo preoccuparci della <em>byte endianness</em> nella gestione dei file PFM ‚òπ</p></li>
</ul>
</section>
<section id="dati-binari-e-testuali" class="slide level1">
<h1>Dati binari e testuali</h1>
<ul>
<li><p>Oltre al problema della <em>endianness</em>, bisogna anche capire come il proprio linguaggio gestisce i file binari. Guardate questo esempio in C++:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;fstream&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">()</span> <span class="op">{</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">int</span> x<span class="op">{</span><span class="dv">138</span><span class="op">};</span>  <span class="co">// 138 &lt; 256, so the value fits in *one* byte</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="bu">std::</span>ofstream<span class="op"> </span>outf<span class="op">{</span><span class="st">&quot;file.bin&quot;</span><span class="op">};</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  outf <span class="op">&lt;&lt;</span> x<span class="op">;</span> <span class="co">// Ouch! It writes *three* bytes: &#39;1&#39;, &#39;3&#39;, &#39;8&#39;</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Il valore <code>138</code> √® stato salvato in <em>forma testuale</em>! (Se invece usate il tipo <code>uint8_t</code>, il C++ user√† l‚Äôusuale <em>forma binaria</em>)</p></li>
<li><p>Vediamo dunque ora i segreti della codifica testuale.</p></li>
</ul>
</section>
<section id="codifica-testuale" class="slide level1">
<h1>Codifica testuale</h1>
</section>
<section class="slide level1">

<center>
<img data-src="media/email-wrong-encoding.png" />
</center>
</section>
<section class="slide level1">

<center>
<img data-src="media/windows-linux-newlines.png" />
</center>
</section>
<section class="slide level1">

<center>
<img data-src="media/windows-linux-encoding-c++.png" />
</center>
</section>
<section class="slide level1">

<center>
<img data-src="media/windows-linux-encoding-nim-console.png" />
</center>
</section>
<section class="slide level1">

<center>
<img data-src="media/windows-linux-encoding-nim-terminal.png" />
</center>
</section>
<section id="codifica-testuale-1" class="slide level1">
<h1>Codifica testuale</h1>
<ul>
<li><p>I caratteri del computer vengono codificati tramite numeri; la pi√π usata √® la codifica ASCII:</p>
<ul>
<li>La lettera <code>A</code> √® codificata dal numero 65, <code>B</code> da 66, <code>C</code> da 67, etc.;</li>
<li>La lettera <code>a</code> √® codificata dal numero 97, <code>b</code> da 98, etc.;</li>
<li>La cifra <code>0</code> √® codificata dal numero 48, <code>1</code> da 49, etc.</li>
</ul></li>
<li><p>Codificare una parola come <code>Casa</code> vuol dire rappresentare la parola con la sequenza di valori <code>67 97 115 97 = 0x43 0x61 0x73 0x61</code>.</p></li>
<li><p>Questi codici numerici fanno parte dello standard ASCII, che specifica 128 caratteri. (<a href="https://garbagecollected.org/2017/01/31/four-column-ascii/">Qui c‚Äô√® la tabella completa</a>, spiegata bene).</p></li>
</ul>
</section>
<section id="codifica-di-testi" class="slide level1">
<h1>Codifica di testi</h1>
<ul>
<li><p>Lo standard ASCII √® semplicissimo, eppure sufficiente per codificare testi:</p>
<pre class="text"><code>Beauty - be not caused - It Is -
Chase it, and it ceases -
Chase it not, and it abides -

Overtake the Creases

In the Meadow - when the Wind
Runs his fingers thro&#39; it -
Deity will see to it
That You never do it -

(Emily Dickinson, 1863)</code></pre></li>
<li><p>Ma come si codifica la fine della riga in ogni verso della poesia?</p></li>
<li><p>In 128 valori √® possibile codificare <em>tutti</em> i caratteri?</p></li>
</ul>
</section>
<section id="ritorno-a-capo" class="slide level1">
<h1>Ritorno a capo</h1>
<ul>
<li><p>Il modo per indicare un ritorno a capo dipende dal sistema operativo!</p></li>
<li><p>Nelle macchine da scrivere c‚Äôerano due operazioni da fare per iniziare una nuova riga (vedi <a href="https://www.youtube.com/watch?v=r97JHr13T98">questo video YouTube</a>):</p>
<ol type="1">
<li>Spostarsi verso il bordo sinistro/destro del foglio (<em>carriage return</em>, movimento orizzontale);</li>
<li>Muoversi alla riga successiva (<em>line feed</em>, movimento verticale).</li>
</ol></li>
<li><p>Nella codifica ASCII c‚Äô√® un carattere per ciascuno dei due comandi, che corrispondono a <code>13</code> (<em>carriage return</em>, indicato anche come <code>\r</code>) e <code>10</code> (<em>line feed</em>, indicato con <code>\n</code>). Questi erano indispensabili per i terminali <em>teletype</em>.</p></li>
</ul>
</section>
<section id="terminale-teletype-asr-33" class="slide level1">
<h1>Terminale teletype <a href="http://bytecollector.com/asr_33.htm">ASR-33</a></h1>
<center>
<img data-src="media/asr-33_vcf_02.jpg" height="520" />
</center>
<p>Vedete questo <a href="https://www.howtogeek.com/727213/what-are-teletypes-and-why-were-they-used-with-computers/">link</a> per un po‚Äô di storia su questo tipo di terminali.</p>
</section>
<section id="tipi-di-ritorno-a-capo" class="slide level1">
<h1>Tipi di ritorno a capo</h1>
<ul>
<li><p>Oggi non si usano pi√π terminali teletype, ma <code>\n</code> e <code>\r</code> sono ancora usati</p></li>
<li><p>Il tipo di ritorno a capo dipende dal sistema operativo utilizzato:</p>
<table>
<thead>
<tr class="header">
<th>Sistema operativo</th>
<th>Codifica</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Windows, DOS</td>
<td><code>13 10</code> (<code>\r\n</code>)</td>
</tr>
<tr class="even">
<td>RISC OS</td>
<td><code>10 13</code> (<code>\n\r</code>)</td>
</tr>
<tr class="odd">
<td>C64, macOS classic</td>
<td><code>13</code> (<code>\r</code>)</td>
</tr>
<tr class="even">
<td>Linux, Mac OS X</td>
<td><code>10</code> (<code>\n</code>)</td>
</tr>
</tbody>
</table></li>
<li><p>Git si aspetta il formato Linux (<code>\n</code>) nei file aggiunti con <code>git add</code></p></li>
</ul>
</section>
<section id="oltre-i-127-caratteri" class="slide level1">
<h1>Oltre i 127 caratteri</h1>
<ul>
<li><p>Anche se ASCII nacque per computer con 7 bit per byte, ben presto i produttori di computer si uniformarono per usare 8 bit in ogni byte</p></li>
<li><p>Siccome <span class="math inline">2^8 = 256</span>, questo vuol dire che i numeri 128‚Äì255 sono inutilizzati in ASCII: uno spreco!</p></li>
<li><p>Per venire incontro alle esigenze degli utenti di lingua non inglese, si inventarono le <em>code page</em></p></li>
<li><p>Una <em>code page</em> √® una tabella di corrispondenze tra i numeri 128‚Äì255 e dei caratteri</p></li>
</ul>
</section>
<section id="esempi-di-code-page" class="slide level1">
<h1>Esempi di <em>code page</em></h1>
<p>Code page 850 (latina)</p>
<p><img data-src="media/cp850.png" /></p>
</section>
<section id="esempi-di-code-page-1" class="slide level1">
<h1>Esempi di <em>code page</em></h1>
<p>Code page 866 (cirillica)</p>
<p><img data-src="media/cp866.png" /></p>
</section>
<section id="problemi-delle-code-page" class="slide level1">
<h1>Problemi delle <em>code page</em></h1>
<ul>
<li><p>Se si esegue questo comando sotto un sistema MS-DOS che usa la <em>code page</em> 850:</p>
<pre><code>c:\&gt; echo √® &gt; file.txt</code></pre>
<p>il primo byte del file avrebbe valore <code>130</code>, e verrebbe rappresentato correttamente:</p>
<pre><code>c:\&gt; type file.txt
√®</code></pre></li>
<li><p>Copiando per√≤ il file su un computer con <em>code page</em> 866, si otterrebbe questo:</p>
<pre><code>c:\&gt; type file.txt
—ì</code></pre></li>
</ul>
</section>
<section id="limiti-delle-code-page" class="slide level1">
<h1>Limiti delle <em>code page</em></h1>
<ul>
<li><p>Abbiamo visto che ASCII √® un sistema centrato sul sistema di scrittura usato negli USA, e non include caratteri accentati come ¬´√®¬ª, ¬´√©¬ª, ¬´√º¬ª, ¬´√¢¬ª, etc.</p></li>
<li><p>Il sistema delle <em>code page</em> ha mostrato ben presto i suoi limiti: come scrivere testi in cui si richiedono pi√π scritture contemporaneamente?</p>
<center>
<p><img data-src="media/narratological-commentary-to-odissey.png" /></p>
</center></li>
<li><p>Oltre agli accenti sulle lettere latine, sono esistenti nel mondo molti altri alfabeti e simboli, sia contemporanei (greco, cirillico, cinese, i simboli matematici, etc.) che antichi (geroglifici egizi, caratteri cuneiformi sumerici)</p></li>
</ul>
</section>
<section id="lo-standard-unicode" class="slide level1">
<h1>Lo standard Unicode</h1>
<ul>
<li><p>Standard internazionale nato nel 1991, che copre praticamente tutti i sistemi di scrittura oggi esistenti al mondo.</p></li>
<li><p>Oggi √® supportato quasi universalmente.</p></li>
<li><p>Viene aggiornato periodicamente, circa una volta all‚Äôanno.</p></li>
<li><p>Supporta sia scritture moderne (latino, cirillico, ebraico, arabo‚Ä¶) che antiche (geroglifici egizi: ìÄÉ, scrittura sumerico-accadica: íÄÑ)</p></li>
<li><p>Ha un ottimo supporto anche per caratteri matematici (‚àû, ‚àà, ‚àÄ), emoticons (üòÄ, üòâ), simboli musicali (‚ô≠, ‚ôØ, ùÑû), etc.</p></li>
</ul>
</section>
<section id="versioni-unicode" class="slide level1">
<h1>Versioni Unicode</h1>
<table>
<thead>
<tr class="header">
<th>Versione</th>
<th>Data</th>
<th>Scritture</th>
<th>Caratteri</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
<td>Ottobre 1991</td>
<td>24</td>
<td>7,129</td>
</tr>
<tr class="even">
<td>‚Ä¶</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>11.0</td>
<td>Giugno 2018</td>
<td>146</td>
<td>137,374</td>
</tr>
<tr class="even">
<td>12.0</td>
<td>Marzo 2019</td>
<td>150</td>
<td>137,928</td>
</tr>
<tr class="odd">
<td>13.0</td>
<td>Marzo 2020</td>
<td>154</td>
<td>143,859</td>
</tr>
<tr class="even">
<td>14.0</td>
<td>Settembre 2021</td>
<td>159</td>
<td>144,697</td>
</tr>
</tbody>
</table>
</section>
<section id="esempi-di-caratteri-unicode" class="slide level1">
<h1>Esempi di caratteri Unicode</h1>
<ul>
<li>Lettera A maiuscola: <code>A</code> (65, uguale all‚ÄôASCII!);</li>
<li>Lettera A minuscola con accento acuto: <code>√†</code> (224);</li>
<li>Lettera E maiuscola con accento grave: <code>√â</code> (201);</li>
<li>Puntini di sospensione: <code>‚Ä¶</code> (8230);</li>
<li>Bemolle: <code>‚ô≠</code> (9837);</li>
<li>Faccina che ride: <code>üòÄ</code> (128.512).</li>
</ul>
</section>
<section id="codifica-unicode" class="slide level1">
<h1>Codifica Unicode</h1>
<ul>
<li><p>Ogni carattere Unicode √® associato a un valore numerico, chiamato <em>code point</em>.</p></li>
<li><p>Si possono <a href="https://en.wikipedia.org/wiki/Combining_character">combinare insieme caratteri</a>: unendo <code>a</code> e <code>^</code> per formare <code>√¢</code>.</p></li>
<li><p>Le lettere accentate pi√π comuni hanno per√≤ una <a href="https://en.wikipedia.org/wiki/Precomposed_character">codifica dedicata</a>. Queste lettere sono quindi codificabili in <strong>pi√π modi</strong> secondo lo standard Unicode. (Questo rende complicato confrontare due stringhe!)</p></li>
<li><p>Un <em>grafema</em> √® il risultato di una combinazione di uno o pi√π code point. Quindi la parola <code>cos√¨</code> √® composta da quattro grafemi: <code>c</code>, <code>o</code>, <code>s</code> ed <code>√¨</code> (che pu√≤ essere il <em>code point</em> 236, oppure la combinazione dei code point <code>i</code> e `).</p></li>
<li><p>La combinazione di caratteri diversi √® molto importante in certe scritture come il cinese.</p></li>
</ul>
</section>
<section id="codificare-i-code-point" class="slide level1">
<h1>Codificare i <em>code point</em></h1>
<ul>
<li><p>Lo standard Unicode possiede molti <em>code point</em>, e a ogni versione se ne aggiungono di nuovi.</p></li>
<li><p>Questo pone un problema nella codifica dei <em>code point</em> su file: ASCII usava un byte per carattere perch√© il set era limitato. Ma per Unicode quanti byte per <em>code point</em> usare? 1? 2? 100?</p>
<ul>
<li>Se si scegliesse un valore basso, si limiterebbe l‚Äôestendibilit√† di Unicode.</li>
<li>Se si scegliesse un valore molto alto, i file di testo aumenterebbero di dimensione inutilmente: la poesia di E.¬†Dickinson richiede 232 byte in codifica ASCII (un byte per carattere). Usare 4 byte per carattere quadruplicherebbe lo spazio.</li>
</ul></li>
</ul>
</section>
<section id="codifiche-oggi-usate" class="slide level1">
<h1>Codifiche oggi usate</h1>
<ul>
<li><p>Storicamente sono state proposte varie codifiche per Unicode.</p></li>
<li><p>Le pi√π usate oggi sono le codifiche UTF (Unicode Transformation Format), che esistono in tre versioni:</p>
<ul>
<li>UTF8 (usata nei sistemi Linux e Mac OS X);</li>
<li>UTF16 (usata in Windows);</li>
<li>UTF32 (molto comoda dal punto di vista del software).</li>
</ul></li>
</ul>
</section>
<section id="utf-8" class="slide level1">
<h1>UTF-8</h1>
<ul>
<li><p>√à oggi la codifica pi√π usata in assoluto (tranne che sotto Windows üò¢).</p></li>
<li><p>Il numero di byte usati per un <em>code point</em> √® variabile da 1 a 4.</p></li>
<li><p>√à compatibile con la codifica ASCII: un file ASCII √® automaticamente anche un file UTF-8 valido</p></li>
<li><p>Sfrutta il fatto che la codifica ASCII usa solo 7 degli 8 bit in un byte, e che i primi 127 <em>code point</em> Unicode sono uguali ai valori ASCII.</p></li>
</ul>
</section>
<section id="codifica-utf-8" class="slide level1">
<h1>Codifica UTF-8</h1>
<table>
<thead>
<tr class="header">
<th>Code point</th>
<th>Byte 1</th>
<th>Byte 2</th>
<th>Byte 3</th>
<th>Byte 4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>0x0000</code>‚Äì<code>0x007F</code></td>
<td><code>0xxxxxxx</code></td>
<td>‚Äî</td>
<td>‚Äî</td>
<td>‚Äî</td>
</tr>
<tr class="even">
<td><code>0x0080</code>‚Äì<code>0x07FF</code></td>
<td><code>110xxxxx</code></td>
<td><code>10xxxxxx</code></td>
<td>‚Äî</td>
<td>‚Äî</td>
</tr>
<tr class="odd">
<td><code>0x0800</code>‚Äì<code>0xFFFF</code></td>
<td><code>1110xxxx</code></td>
<td><code>10xxxxxx</code></td>
<td><code>10xxxxxx</code></td>
<td>‚Äî</td>
</tr>
<tr class="even">
<td><code>0x10000</code>‚Äì<code>0x10FFFF</code></td>
<td><code>11110xxx</code></td>
<td><code>10xxxxxx</code></td>
<td><code>10xxxxxx</code></td>
<td><code>10xxxxxx</code></td>
</tr>
</tbody>
</table>
</section>
<section id="codifica-utf-16" class="slide level1">
<h1>Codifica UTF-16</h1>
<ul>
<li><p>Funziona come la codifica UTF-8, ma si usano coppie di byte (<span class="math inline">8 + 8 = 16</span>).</p></li>
<li><p>Un <em>code point</em> pu√≤ essere codificato da due oppure quattro byte.</p></li>
<li><p>C‚Äô√® qui per√≤ un problema di <em>endianness</em>: il valore <code>0x2A6C</code> si scrive come la coppia di byte <code>0x2A 0x6C</code> (<em>big endian</em>) oppure <code>0x6C 0x2A</code> (<em>little endian</em>)?</p></li>
<li><p>Nei file di testo codificati con UTF-16 si inserisce all‚Äôinizio del file il cosiddetto BOM (<em>byte-order marker</em>) che corrisponde al <em>code point</em> <code>0xFEFF</code>. Se i primi due byte di un file sono <code>0xFE 0xFF</code>, allora √® chiaro che il file usa <em>big endian</em>, se sono <code>0xFF 0xFE</code> usa <em>little endian</em>. (Anche UTF-8 ha un BOM, <code>0xEF 0xBB 0xBF</code>).</p></li>
<li><p>UTF-16 √® usato da Windows e nei linguaggi basati su Java (Kotlin, Scala, etc.).</p></li>
</ul>
</section>
<section id="codifica-utf-32" class="slide level1">
<h1>Codifica UTF-32</h1>
<ul>
<li><p>Ovviamente, usa 32 bit per <em>code point</em>.</p></li>
<li><p>In questo caso non c‚Äô√® ambiguit√†: ogni code point usa esattamente quattro byte.</p></li>
<li><p>√à ovviamente la codifica pi√π inefficiente dal punto di vista dello spazio occupato: la poesia di Emily Dickinson occuperebbe 928 byte in UTF-32, e solo 232 byte in ASCII/UTF-8 (quattro volte tanto!)</p></li>
<li><p>√à per√≤ la codifica pi√π semplice: ogni code point occupa sempre lo spazio di un tipo <code>uint32_t</code> in C/C++.</p></li>
</ul>
</section>
<section id="file-binari-e-testuali" class="slide level1">
<h1>File binari e testuali</h1>
<ul>
<li><p>Quanto detto oggi spiega perch√© √® spesso pi√π vantaggioso usare <em>file binari</em> anzich√© testuali: √® molto pi√π facile per un programma leggerli e scriverli!</p></li>
<li><p>Quasi tutti i formati grafici oggi usati (PNG, JPEG, GIF, etc.) si basano su codifiche binarie.</p></li>
<li><p>I file testuali hanno per√≤ alcuni vantaggi significativi:</p>
<ul>
<li><p>Sono pi√π facili da leggere e da scrivere per un essere umano;</p></li>
<li><p>Non hanno problemi di <em>endianness</em>.</p></li>
</ul></li>
<li><p>Inoltre, c‚Äô√® un tipo importante di file di testo che avete gi√† iniziato ad usare: i vostri <strong>codici sorgente</strong>!</p></li>
</ul>
</section>
<section id="codifica-di-file-sorgente" class="slide level1">
<h1>Codifica di file sorgente</h1>
<ul>
<li><p>Quasi tutti i linguaggi richiedono parole chiave e simboli che si limitano ad usare caratteri ASCII (alcuni consentono anche caratteri Unicode nei nomi di variabili e di funzioni, come Julia e Python)</p></li>
<li><p>Per√≤ nelle slide mostrate prima abbiamo visto che nei programmi si possono inserire anche stringhe letterali:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;The calculation completed successfully! üòÄ&quot;</span>)</span></code></pre></div></li>
<li><p>Come assicurarsi che il codice sia interpretato correttamente?</p></li>
</ul>
</section>
<section id="codifiche-di-file-sorgente" class="slide level1">
<h1>Codifiche di file sorgente</h1>
<ul>
<li><p>Alcuni linguaggi (<a href="https://nim-lang.org/docs/manual.html#lexical-analysis-encoding">Nim</a>, <a href="https://doc.rust-lang.org/reference/input-format.html">Rust</a>‚Ä¶) impongono la codifica UTF-8</p></li>
<li><p><a href="https://dlang.org/spec/lex.html#source_text">D</a> supporta tutte le codifiche Unicode (UTF-8, UTF-16, UTF-32, con qualsiasi <em>endianness</em>)</p></li>
<li><p>Python permette in linea di principio <a href="https://peps.python.org/pep-0263/">qualsiasi codifica</a>, indicata con un commento all‚Äôinizio del file:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/usr/bin/env python3</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># -*- encoding: utf-8 -*-</span></span></code></pre></div></li>
<li><p>Il rapporto del C++ con Unicode √® complicato! <code>clang</code> usa UTF-8, GCC la ammette da linea di comando (<code>-finput-charset=</code>)‚Ä¶</p></li>
</ul>
</section>
<section id="codifiche-di-file-sorgente-1" class="slide level1">
<h1>Codifiche di file sorgente</h1>
<ul>
<li><p>Ma questo risolve solo parte del problema, perch√© se il programma stampa una stringa UTF-8, bisogna assicurarsi che il sistema su cui gira il programma riconosca UTF-8 (Vedi le schermate all‚Äôinizio di questa sezione).</p></li>
<li><p>Fate attenzione alla codifica usata dal vostro editor; di solito inserire la stringa <code>encoding: utf-8</code> in un commento all‚Äôinizio del file aiuta (√® riconosciuta sia da Emacs che da Vim)</p></li>
<li><p>Tutti gli editor moderni consentono comunque di cambiare la codifica di un file</p></li>
<li><p>Da linea di comando potete usare il programma <a href="https://en.wikipedia.org/wiki/Iconv"><code>iconv</code></a></p></li>
</ul>
</section>
<section id="gestione-degli-errori" class="slide level1">
<h1>Gestione degli errori</h1>
</section>
<section id="errori" class="slide level1">
<h1>Errori</h1>
<ul>
<li>Nella scorsa esercitazione abbiamo implementato il tipo <code>HdrImage</code>.</li>
<li>Questa settimana implementeremo le funzioni per scrivere e leggere file PFM.</li>
<li>Legge e scrivere file √® un‚Äôattivit√† che √® facilmente soggetta ad errori:
<ul>
<li>La directory in cui salvare il file non esiste, oppure √® protetta da scrittura</li>
<li>Il file specificato dall‚Äôutente non esiste</li>
<li>Il file √® danneggiato</li>
<li>Il file √® in un formato valido ma che il nostro codice non √® in grado di caricare (es., un file √® codificato in <em>big endian</em>, ma noi abbiamo previsto solo <em>little endian</em>)</li>
</ul></li>
</ul>
</section>
<section id="tipi-di-errore" class="slide level1">
<h1>Tipi di errore</h1>
<ul>
<li><p>Gli errori possono essere suddivisi in due classi:</p>
<ul>
<li>Errori di pertinenza del programmatore</li>
<li>Errori di pertinenza dell‚Äôutente</li>
</ul></li>
<li><p>A seconda del tipo di errore in cui vi imbattete, la sua gestione √® diversa.</p></li>
</ul>
</section>
<section id="errori-del-programmatore" class="slide level1">
<h1>Errori del programmatore</h1>
<ul>
<li>Si tratta di un errore logico del programma.</li>
<li>Un programma ¬´perfetto¬ª non dovrebbe mai avere errori logici.</li>
<li>Se si ha l‚Äôevidenza che √® avvenuto un errore logico, sarebbe meglio segnalarlo <strong>nel modo pi√π rumoroso possibile</strong>.</li>
</ul>
</section>
<section id="esempio" class="slide level1">
<h1>Esempio</h1>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>my_list <span class="op">=</span> [<span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">8</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">9</span>]</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="bu">sorted</span> <span class="op">=</span> my_sort_function(my_list)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> (<span class="bu">len</span>(my_list) <span class="op">==</span> <span class="bu">len</span>(<span class="bu">sorted</span>)):</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Error, mismatch in the length of the sorted list&quot;</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> (<span class="bu">sorted</span>[<span class="dv">0</span>] <span class="op">&lt;=</span> <span class="bu">sorted</span>[<span class="dv">1</span>]):</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Error, the array is not sorted&quot;</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co"># The program continues</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>...</span></code></pre></div>
</section>
<section id="esempio-migliorato" class="slide level1">
<h1>Esempio migliorato</h1>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>my_list <span class="op">=</span> [<span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">8</span>, <span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">9</span>]</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="bu">sorted</span> <span class="op">=</span> my_sort_function(my_list)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># If any &quot;assert&quot;, the program will crash and will print details</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># about what the code was doing. If PDB support is turned on,</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># a debugger will be fired automatically.</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="bu">len</span>(my_list) <span class="op">==</span> <span class="bu">len</span>(<span class="bu">sorted</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="bu">sorted</span>[<span class="dv">0</span>] <span class="op">&lt;=</span> <span class="bu">sorted</span>[<span class="dv">1</span>]</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># The program continues</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>...</span></code></pre></div>
</section>
<section id="gestione-errori-del-programmatore" class="slide level1">
<h1>Gestione errori del programmatore</h1>
<ul>
<li>Tutti i linguaggi implementano funzioni che consentono di mandare in crash un programma (es., <code>assert</code> e <code>abort</code> in C/C++).</li>
<li>Queste istruzioni solitamente stampano a video una serie di dettagli sulla causa dell‚Äôerrore, e sono pensate per essere usate insieme a un debugger.</li>
<li>Eseguire un debugger √® sensato: se l‚Äôerrore √® logico, √® il programmatore che deve mettere mano al codice, non l‚Äôutente!</li>
<li>Attenzione al fatto che alcune di queste funzioni potrebbero non essere compilate in modalit√† <em>release</em> (es., <a href="https://nim-lang.org/docs/assertions.html#assert.t,untyped,string"><code>assert</code></a> vs <a href="https://nim-lang.org/docs/assertions.html#doAssert.t%2Cuntyped%2Cstring"><code>doAssert</code></a> in Nim).</li>
</ul>
</section>
<section id="errori-dellutente" class="slide level1">
<h1>Errori dell‚Äôutente</h1>
<ul>
<li>Sono errori causati da un input o un contesto sbagliato, e non per colpa di un errore nel programma:
<ul>
<li>L‚Äôutente chiede di leggere un file che non esiste;</li>
<li>L‚Äôutente chiede di scrivere un file su un supporto che non ha pi√π spazio libero;</li>
<li>L‚Äôutente specifica un input scorretto;</li>
<li>L‚Äôutente chiede di usare una periferica (stampante?) non connessa al computer oppure spenta.</li>
</ul></li>
<li>Vanno gestiti in modo molto diverso dagli errori del programmatore: non vogliamo che il programma vada in crash in questi casi!</li>
</ul>
</section>
<section id="esempio-1" class="slide level1">
<h1>Esempio</h1>
<p><asciinema-player src="./cast/user-error-74x25.cast" cols="74" rows="25" font-size="medium"></asciinema-player></p>
</section>
<section id="gestire-errori-dellutente" class="slide level1">
<h1>Gestire errori dell‚Äôutente</h1>
<ul>
<li>Gli errori dell‚Äôutente sono <strong>inevitabili</strong>.</li>
<li>Se si ha evidenza che l‚Äôutente ha commesso un errore, ci sono diversi modi di reagire:
<ol type="1">
<li><p>Stampare un messaggio di errore, il pi√π chiaro possibile;</p></li>
<li><p>Chiedere all‚Äôutente di inserire di nuovo il dato scorretto;</p></li>
<li><p>In certi contesti il codice pu√≤ decidere autonomamente come correggere l‚Äôerrore.</p>
<p>Ad esempio, se si chiede un valore numerico entro un certo intervallo <span class="math inline">[a, b]</span> e il valore fornito √® <span class="math inline">x &gt; b</span>, si pu√≤ porre <span class="math inline">x = b</span> e continuare.</p></li>
</ol></li>
</ul>
</section>
<section id="correzione-errori-12" class="slide level1">
<h1>Correzione errori (1/2)</h1>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="bu">float</span>(<span class="bu">input</span>(<span class="st">&quot;Insert a number: &quot;</span>))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> <span class="bu">float</span>(<span class="bu">input</span>(<span class="st">&quot;Insert another number: &quot;</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> y <span class="op">!=</span> <span class="fl">0.0</span>:</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;The ratio </span><span class="sc">{</span>x<span class="sc">}</span><span class="ss"> / </span><span class="sc">{</span>y<span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span>x <span class="op">/</span> y<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Error, the second number cannot be zero!&quot;</span>)</span></code></pre></div>
</section>
<section id="correzione-errori-22" class="slide level1">
<h1>Correzione errori (2/2)</h1>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="bu">float</span>(<span class="bu">input</span>(<span class="st">&quot;Insert a number: &quot;</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="va">True</span>:</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> <span class="bu">float</span>(<span class="bu">input</span>(<span class="st">&quot;Insert another number: &quot;</span>))</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> y <span class="op">==</span> <span class="fl">0.0</span>:</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Error, the second number cannot be zero!&quot;</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;The ratio </span><span class="sc">{</span>x<span class="sc">}</span><span class="ss"> / </span><span class="sc">{</span>y<span class="sc">}</span><span class="ss"> is </span><span class="sc">{</span>x <span class="op">/</span> y<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
</section>
<section id="programma-corretto" class="slide level1">
<h1>Programma corretto</h1>
<p><asciinema-player src="./cast/user-error-corrected-74x25.cast" cols="74" rows="25" font-size="medium"></asciinema-player></p>
</section>
<section id="messaggi-derrore" class="slide level1">
<h1>Messaggi d‚Äôerrore</h1>
<ul>
<li><p>Gli studenti hanno spesso la tendenza a stampare messaggi di errore.</p></li>
<li><p>Esempio (sbagliato) preso da un tema d‚Äôesame TNDS:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> Bisezione<span class="op">::</span>CercaZeri<span class="op">(</span><span class="dt">double</span> a<span class="op">,</span> <span class="dt">double</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span><span class="op">(</span>f<span class="op">-&gt;</span>Eval<span class="op">(</span>a<span class="op">)</span> <span class="op">*</span> f<span class="op">-&gt;</span>Eval<span class="op">(</span>b<span class="op">)</span> <span class="op">&gt;=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>        cout <span class="op">&lt;&lt;</span> <span class="st">&quot;Errore, teorema degli zeri non soddisfatto</span><span class="sc">\n</span><span class="st">&quot;</span><span class="op">;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Etc.</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Non c‚Äô√® un <code>return</code> in corrispondenza dell‚Äô<code>if</code>, e l‚Äôesercizio chiedeva di calcolare lo zero di una funzione in un intervallo in cui lo zero <strong>doveva esserci</strong>. Se il teorema degli zeri non √® soddisfatto, vuol dire che c‚Äô√® un errore in <code>a</code> oppure <code>b</code>.</p></li>
</ul>
</section>
<section id="visibilit√†-dei-messaggi-di-errore" class="slide level1">
<h1>Visibilit√† dei messaggi di errore</h1>
<ul>
<li><p>Se una funzione stampa un messaggio quando capita un errore, √® molto probabile che quel messaggio si perda all‚Äôinterno dell‚Äôoutput:</p>
<pre class="text"><code>$ python3 my-beautiful-program.py
Initializing the program...
Now I am reading data from the device
The device has sent 163421 samples
Computing statistics on the samples
Error, some samples are negative
Sorting the samples
Running a Monte Carlo simulations, please wait...
Done, time elapsed: 164.96 seconds
Producing the plots...
Done, the results are saved in &quot;output.pdf&quot;
$</code></pre></li>
<li><p>Meglio rendere l‚Äôerrore pi√π visibile, ad esempio con i colori, oppure (meglio!) fermare del tutto l‚Äôesecuzione del programma appena l‚Äôerrore si verifica.</p></li>
</ul>
</section>
<section id="errori-dellutente-nelle-funzioni" class="slide level1">
<h1>Errori dell‚Äôutente nelle funzioni</h1>
<ul>
<li>√à solitamente molto semplice come gestire gli errori dell‚Äôutente nel <code>main</code> di un programma.</li>
<li>√à invece meno chiaro come gestire gli errori nell‚Äôinput passato a una funzione o un metodo, come ad esempio <code>Bisezione::CercaZeri</code> (gli estremi erano un input dell‚Äôutente, o erano stati calcolati automaticamente dal programma?).</li>
<li>Nessuna funzione o metodo dovrebbe <strong>mai</strong> fare qualcosa di catastrofico (mandare in crash il programma) o <strong>visibile</strong> (stampare un messaggio d‚Äôerrore a video).</li>
<li>La <strong>regola aurea</strong> √® che la funzione restituisca un valore di ritorno che segnali l‚Äôerrore, oppure che sollevi un‚Äôeccezione.</li>
</ul>
</section>
<section id="eccezioni" class="slide level1">
<h1>Eccezioni</h1>
</section>
<section id="eccezioni-1" class="slide level1">
<h1>Eccezioni</h1>
<ul>
<li><p>Una eccezione serve per ¬´mandare in crash¬ª un programma in modo controllato:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> my_function(...):</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> something_wrong:</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">&quot;Error!&quot;</span>)</span></code></pre></div></li>
<li><p>A differenza di funzioni come <code>abort</code>, il crash pu√≤ essere sospeso o interrotto (in gergo, ¬´catturato¬ª), e l‚Äôeccezione pu√≤ segnalare il tipo di errore che ne ha causato la creazione.</p></li>
</ul>
</section>
<section class="slide level1">

<p><asciinema-player src="./cast/exceptions-100x23.cast" cols="100" rows="23" font-size="18"></asciinema-player></p>
</section>
<section id="tipi-per-eccezioni" class="slide level1">
<h1>Tipi per eccezioni</h1>
<ul>
<li><p>Una eccezione √® un tipo di <em>crash</em> che √® <strong>tipizzato</strong> (es., <code>ValueError</code>)</p></li>
<li><p>Questi tipi possono avere al loro interno informazioni aggiuntive:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> WrongNumber(<span class="pp">Exception</span>):</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, num):</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.num <span class="op">=</span> num</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="bu">float</span>(<span class="bu">input</span>(<span class="st">&quot;Enter some number: &quot;</span>))</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> x <span class="op">&gt;</span> <span class="dv">3</span>:</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">raise</span> WrongNumber(num<span class="op">=</span>x)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> WrongNumber <span class="im">as</span> e:</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;You entered a number that is too large: &quot;</span>, e.num)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Enter some number: 5</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co"># You entered a number that is too large: 5</span></span></code></pre></div></li>
</ul>
</section>
<section id="propagare-eccezioni" class="slide level1">
<h1>Propagare eccezioni</h1>
<ul>
<li><p>Una eccezione che non viene catturata si diffonde lungo tutta la catena dei chiamanti</p></li>
<li><p>Essa pu√≤ essere catturata a qualsiasi livello:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f():</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">Exception</span>(<span class="st">&quot;Error!&quot;</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> g():</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    f()</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> h():</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:      <span class="co"># You can capture exceptions within functions, of course</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>        g()   <span class="co"># g doesn&#39;t raise exceptions, but f() does</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>:</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;Got an exception!&quot;</span>)</span></code></pre></div></li>
</ul>
</section>
<section id="prestazioni" class="slide level1">
<h1>Prestazioni</h1>
<ul>
<li><p>Le eccezioni rallentano i programmi, perch√© il compilatore deve inserire all‚Äôinterno delle funzioni del codice ¬´nascosto¬ª che possa gestirle</p></li>
<li><p>Per questo alcuni linguaggi (Rust, Go‚Ä¶) non le supportano, e in altri si possono disabilitare all‚Äôinterno di specifiche funzioni/metodi (<code>nothrow</code> in C++)</p></li>
<li><p>Nel programma che svilupperemo useremo il seguente approccio, che non causer√† alcun rallentamento significativo:</p>
<ul>
<li>Leggeremo input dall‚Äôutente, usando eccezioni per segnalare errori</li>
<li>Calcoleremo la soluzione dell‚Äôequazione del rendering, evitando eccezioni: questa sar√† la parte pi√π lenta</li>
<li>Salveremo il risultato in un file, usando nuovamente le eccezioni</li>
</ul></li>
</ul>
</section>
<section id="alternative-alle-eccezioni" class="slide level1">
<h1>Alternative alle eccezioni</h1>
</section>
<section id="parametri-derrore" class="slide level1">
<h1>Parametri d‚Äôerrore</h1>
<ul>
<li><p>Si pu√≤ accettare un parametro addizionale che segnali l‚Äôerrore:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> my_function<span class="op">(...,</span> <span class="dt">bool</span> <span class="op">&amp;</span> error<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    error <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>something_wrong<span class="op">)</span> <span class="op">{</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>        error <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fl">0.0</span><span class="op">;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li>
<li><p>Al posto di un <code>bool</code> potete usare una <code>enum class</code> per registrare il tipo di errore, o addirittura una <code>struct</code> per racchiudere informazioni complesse.</p></li>
</ul>
</section>
<section id="tipi-nullable" class="slide level1">
<h1>Tipi <em>nullable</em></h1>
<ul>
<li><p>Linguaggi come C# e Kotlin definiscono il tipo <em>nullable</em>, che pu√≤ essere usato con qualsiasi tipo, e ne indica l‚Äô<em>assenza</em>:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode csharp"><code class="sourceCode cs"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">// C# example</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Note the &quot;?&quot; after &quot;double&quot;: this is the same syntax as in Kotlin</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span><span class="op">?</span> result <span class="op">=</span> <span class="fu">my_function</span><span class="op">(...);</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> <span class="op">(!</span> result<span class="op">.</span><span class="fu">HasValue</span><span class="op">)</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Something wrong happened, my_function didn&#39;t compute the result</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div></li>
<li><p>In alternativa, pu√≤ esserci un tipo definito nella libreria standard che implementa questa funzionalit√† (<a href="https://en.cppreference.com/w/cpp/utility/optional"><code>std::optional</code></a> in C++, <a href="https://nim-lang.org/docs/options.html">Option</a> in Nim)</p></li>
</ul>
</section>
<section id="tipi-result" class="slide level1">
<h1>Tipi <code>Result</code></h1>
<ul>
<li><p>In Rust esiste il tipo <code>Result</code>, che √® una versione pi√π versatile del tipo <code>std::optional</code> in C++ (ma c‚Äô√® una proposta per <a href="il%20prohttp://www.open-std.org/jtc1/sc22/wg21/docs/papers/2021/p0323r10.html"><code>std::expected</code></a>‚Ä¶)</p></li>
<li><p>Il tipo <code>Result</code> √® un <em>sum type</em> (li vedremo meglio pi√π avanti), e permette di associare un tipo <code>A</code> in caso di successo, e un tipo <code>B</code> in caso di fallimento:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode rust"><code class="sourceCode rust"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">struct</span> OutputData <span class="op">{</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> mass<span class="op">:</span> <span class="dt">f32</span><span class="op">;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> charge<span class="op">:</span> <span class="dt">f32</span><span class="op">;</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="kw">pub</span> <span class="kw">struct</span> SomeError <span class="op">{</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">pub</span> message<span class="op">:</span> <span class="dt">String</span><span class="op">;</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> compute_quantities(‚Ä¶) <span class="op">-&gt;</span> <span class="dt">Result</span><span class="op">&lt;</span>OutputData<span class="op">,</span> SomeError<span class="op">&gt;</span> <span class="op">{</span> ‚Ä¶ <span class="op">}</span></span></code></pre></div></li>
</ul>
</section>
    </div>
  </div>

  <script src="https://unpkg.com/reveal.js@^4//dist/reveal.js"></script>

  <!-- reveal.js plugins -->
  <script src="https://unpkg.com/reveal.js@^4//plugin/notes/notes.js"></script>
  <script src="https://unpkg.com/reveal.js@^4//plugin/search/search.js"></script>
  <script src="https://unpkg.com/reveal.js@^4//plugin/zoom/zoom.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'bottom-right',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: true,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: false,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: true,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'default',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: true,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

       // Parallax background image
       parallaxBackgroundImage: './media/background.png', // e.g. "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'"

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1440,

        height: 810,

        // reveal.js plugins
        plugins: [
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script src="js/asciinema-player.js"></script>
    <script src="https://cdn.plot.ly/plotly-1.58.4.min.js"></script>
    <script type="text/javascript" src="./js/quantization.js"></script>
    </body>
</html>
